
================================================================================
FILE_BEGIN: src\app\layout.tsx
TYPE: TSX
SIZE: 1446 bytes
================================================================================
import type { Metadata } from 'next'
import './globals.css'
import { Providers } from '@/components/Providers'

export const metadata: Metadata = {
  title: 'Property Investment Tracker',
  description: 'Real estate investment analysis and portfolio management platform',
  manifest: '/manifest.json',
  themeColor: '#3b82f6',
  icons: {
    icon: [
      { url: '/favicon.svg', type: 'image/svg+xml' },
    ],
    apple: [
      { url: '/icon-192.svg', sizes: '192x192', type: 'image/svg+xml' },
    ],
  },
  appleWebApp: {
    capable: true,
    statusBarStyle: 'default',
    title: 'PropTracker',
  },
  viewport: {
    width: 'device-width',
    initialScale: 1,
    maximumScale: 1,
    userScalable: false,
  },
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en" className="dark">
      <head>
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="manifest" href="/manifest.json" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="PropTracker" />
      </head>
      <body className="bg-dark-950 text-dark-50 antialiased">
        <Providers>
          {children}
        </Providers>
      </body>
    </html>
  )
}


[FILE_END: src\app\layout.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\app\page.tsx
TYPE: TSX
SIZE: 2373 bytes
================================================================================
import { supabase } from '@/app/lib/db';
import DashboardClient from '@/components/DashboardClient';
import { PropertyProvider } from '@/context/PropertyContext';
import { 
  PropertyWithCalculations, 
  addCalculations, 
  serializeProperties 
} from '@/lib/calculations';

export const dynamic = 'force-dynamic';

/**
 * Fetch properties from the database and add calculations.
 * Uses Supabase client for reliable connection.
 * Returns empty array if database is unavailable.
 */
async function getProperties(): Promise<PropertyWithCalculations[]> {
  try {
    // Use Supabase client instead of Prisma to avoid pooler auth issues
    const { data, error } = await supabase
      .from('properties')
      .select('*')
      .order('created_at', { ascending: false })
    
    if (error) {
      console.error('Supabase error:', error)
      return []
    }
    
    // Convert snake_case to camelCase and handle dates
    const converted = (data || []).map((prop: any) => ({
      ...prop,
      listPrice: prop.list_price,
      equityGap: prop.equity_gap,
      isOwned: prop.is_owned,
      purchasePrice: prop.purchase_price,
      purchaseDate: prop.purchase_date ? new Date(prop.purchase_date) : null,
      rehabCompleted: prop.rehab_completed ? new Date(prop.rehab_completed) : null,
      isFavorite: prop.is_favorite,
      favoriteNotes: prop.favorite_notes,
      dealScore: prop.deal_score,
      riskLevel: prop.risk_level,
      createdAt: new Date(prop.created_at),
      updatedAt: new Date(prop.updated_at),
    }))

    // Serialize Date objects to strings for client-side usage
    const serialized = serializeProperties(converted);
    
    // Add calculated fields using the shared utility
    // @ts-ignore - serializeProperties intentionally converts Date to string
    return serialized.map(addCalculations);
  } catch (error) {
    console.error('Database connection error:', error);
    // Return empty array if database is unavailable
    // The client will fetch from API if needed
    return [];
  }
}

export default async function Page() {
  // Fetch data on the server
  const properties = await getProperties();
  
  // Pass to the client component via context provider
  // This eliminates the "double fetch" pattern
  return (
    <PropertyProvider initialData={properties}>
      <DashboardClient />
    </PropertyProvider>
  );
}


[FILE_END: src\app\page.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\app\properties\[id]\page.tsx
TYPE: TSX
SIZE: 14763 bytes
================================================================================
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import Image from 'next/image';
import { 
  Property, 
  getPricePerSqft, 
  getPricePerDoor, 
  getDecisionColor, 
  calculateCapRate,
  calculateCashOnCashReturn,
  calculateMAO,
  calculateOnePercentRule,
  calculateGrossYield
} from '@/data/properties';

interface PropertyPageProps {
  params: Promise<{ id: string }>;
}

export default function PropertyPage({ params }: PropertyPageProps) {
  const [propertyId, setPropertyId] = useState<string>('');
  const [property, setProperty] = useState<Property | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

useEffect(() => {
  let isMounted = true;
  
  const fetchProperty = async () => {
    try {
      setLoading(true);
      setError(null);

      // Await the params Promise (required in Next.js 15)
      const resolvedParams = await params;
      
      if (!isMounted) return;
      
      const response = await fetch(`/api/properties?id=${resolvedParams.id}`);
      if (!response.ok) {
        throw new Error(`Failed to fetch property: ${response.status}`);
      }

      const data = await response.json();
      if (isMounted) {
        setProperty(data.data);
      }
    } catch (err) {
      console.error('Error fetching property:', err);
      if (isMounted) {
        setError(err instanceof Error ? err.message : 'Failed to fetch property');
      }
    } finally {
      if (isMounted) {
        setLoading(false);
      }
    }
  };

  fetchProperty();
  
  return () => {
    isMounted = false;
  };
}, [params]);

  if (loading) {
    return (
      <div className="min-h-screen bg-dark-950 flex items-center justify-center">
        <div className="flex items-center gap-3 text-white">
          <div className="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin" />
          <span>Loading property...</span>
        </div>
      </div>
    );
  }

  if (error || !property) {
    return (
      <div className="min-h-screen bg-dark-950 flex flex-col items-center justify-center text-white">
        <h1 className="text-2xl font-bold mb-2">Property Not Found</h1>
        <p className="text-dark-400 mb-6">{error || 'The property you are looking for does not exist.'}</p>
        <Link 
          href="/"
          className="px-4 py-2 bg-primary-500 rounded-lg hover:bg-primary-600 transition-colors"
        >
          Return to Dashboard
        </Link>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-dark-950 p-6 md:p-12">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="mb-8">
          <Link 
            href="/"
            className="inline-flex items-center gap-2 px-4 py-2 bg-dark-800 text-white rounded-lg hover:bg-dark-700 transition-colors mb-6"
          >
            <span className="text-lg">←</span>
            Return to Dashboard
          </Link>

          <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-6">
            <div>
              <div className="flex items-center gap-3 mb-2">
                <span
                  className="px-3 py-1 rounded-full text-xs font-semibold"
                  style={{
                    backgroundColor: `${getDecisionColor(property.decision)}20`,
                    color: getDecisionColor(property.decision),
                  }}
                >
                  {property.decision}
                </span>
                <span className="px-3 py-1 bg-dark-800 text-white rounded-full text-xs font-semibold">
                  {property.strategy}
                </span>
              </div>
              <h1 className="text-3xl font-bold text-white mb-2">{property.address}</h1>
              <p className="text-xl text-dark-400">
                {property.city}, {property.state} {property.zip}
              </p>
            </div>

            <div className="flex items-center gap-3">
              <a
                href={property.url}
                target="_blank"
                rel="noopener noreferrer"
                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
              >
                View on Zillow
              </a>
            </div>
          </div>
        </div>

        {/* Main Content */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Property Details */}
          <div className="lg:col-span-2 space-y-8">
            {/* Images */}
            <div className="bg-dark-800 rounded-lg border border-dark-700 p-6">
              <h2 className="text-xl font-semibold text-white mb-4">Property Details</h2>
              
              {property.images && property.images.length > 0 ? (
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                  {property.images.map((image, index) => (
                    <Image
                      key={index}
                      src={image}
                      alt={`Property image ${index + 1}`}
                      className="w-full h-48 object-cover rounded-lg"
                      width={400}
                      height={300}
                      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                    />
                  ))}
                </div>
              ) : (
                <div className="w-full h-48 bg-dark-700 rounded-lg flex items-center justify-center mb-6">
                  <p className="text-dark-400">No images available</p>
                </div>
              )}

              {/* Basic Information */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div>
                  <p className="text-sm text-dark-400 mb-1">List Price</p>
                  <p className="text-lg font-semibold text-emerald-400">
                    ${property.listPrice.toLocaleString()}
                  </p>
                </div>
                <div>
                  <p className="text-sm text-dark-400 mb-1">Square Feet</p>
                  <p className="text-lg font-semibold text-white">
                    {property.sqft.toLocaleString()}
                  </p>
                </div>
                <div>
                  <p className="text-sm text-dark-400 mb-1">Bedrooms</p>
                  <p className="text-lg font-semibold text-white">{property.bedrooms}</p>
                </div>
                <div>
                  <p className="text-sm text-dark-400 mb-1">Bathrooms</p>
                  <p className="text-lg font-semibold text-white">{property.bathrooms}</p>
                </div>
              </div>

              <div className="mt-6">
                <p className="text-sm text-dark-400 mb-2">Type</p>
                <p className="text-white">{property.type}</p>
              </div>

              {property.details && (
                <div className="mt-4">
                  <p className="text-sm text-dark-400 mb-2">Details</p>
                  <p className="text-white">{property.details}</p>
                </div>
              )}

              {property.realtor && (
                <div className="mt-4">
                  <p className="text-sm text-dark-400 mb-2">Realtor</p>
                  <p className="text-white">{property.realtor}</p>
                </div>
              )}

              {property.notes && (
                <div className="mt-4">
                  <p className="text-sm text-dark-400 mb-2">Notes</p>
                  <p className="text-white">{property.notes}</p>
                </div>
              )}
            </div>

            {/* Rationale */}
            <div className="bg-dark-800 rounded-lg border border-dark-700 p-6">
              <h2 className="text-xl font-semibold text-white mb-4">Investment Rationale</h2>
              <p className="text-dark-300">{property.rationale}</p>
            </div>
          </div>

          {/* Financial Analysis */}
          <div className="space-y-6">
            <div className="bg-dark-800 rounded-lg border border-dark-700 p-6">
              <h2 className="text-xl font-semibold text-white mb-6">Financial Analysis</h2>

              {/* Price Metrics */}
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Price per SqFt</p>
                    <p className="text-sm font-semibold text-white">
                      ${getPricePerSqft(property).toFixed(2)}
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Price per Door</p>
                    <p className="text-sm font-semibold text-white">
                      ${getPricePerDoor(property).toFixed(2)}
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Equity Gap</p>
                    <p className="text-sm font-semibold text-amber-400">
                      ${property.equityGap.toLocaleString()}
                    </p>
                  </div>
                </div>
              </div>

              <hr className="my-6 border-dark-700" />

              {/* Investment Metrics */}
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Cap Rate</p>
                    <p className="text-sm font-semibold text-white">
                      {calculateCapRate(property).toFixed(2)}%
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Cash-on-Cash Return</p>
                    <p className="text-sm font-semibold text-white">
                      {calculateCashOnCashReturn(property).toFixed(2)}%
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Gross Yield</p>
                    <p className="text-sm font-semibold text-white">
                      {calculateGrossYield(property).toFixed(2)}%
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">1% Rule</p>
                    <p className={`text-sm font-semibold ${
                      calculateOnePercentRule(property) ? 'text-emerald-400' : 'text-red-400'
                    }`}>
                      {calculateOnePercentRule(property) ? 'Pass' : 'Fail'}
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">MAO</p>
                    <p className="text-sm font-semibold text-emerald-400">
                      ${calculateMAO(property).toLocaleString()}
                    </p>
                  </div>
                </div>
              </div>

              <hr className="my-6 border-dark-700" />

              {/* Expense Estimates */}
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Estimated Rent</p>
                    <p className="text-sm font-semibold text-white">
                      ${property.estimatedRent.toLocaleString()}/mo
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Annual Taxes</p>
                    <p className="text-sm font-semibold text-white">
                      ${property.annualTaxes.toLocaleString()}
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Annual Insurance</p>
                    <p className="text-sm font-semibold text-white">
                      ${property.annualInsurance.toLocaleString()}
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">Renovation Budget</p>
                    <p className="text-sm font-semibold text-white">
                      ${property.renovationBudget.toLocaleString()}
                    </p>
                  </div>
                </div>

                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm text-dark-400">ARV</p>
                    <p className="text-sm font-semibold text-white">
                      ${property.afterRepairValue.toLocaleString()}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Additional Information */}
        <div className="mt-12 bg-dark-800 rounded-lg border border-dark-700 p-6">
          <h2 className="text-xl font-semibold text-white mb-4">Additional Information</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div>
              <p className="text-sm text-dark-400 mb-1">Created At</p>
              <p className="text-white">{new Date(property.createdAt).toLocaleDateString()}</p>
            </div>
            <div>
              <p className="text-sm text-dark-400 mb-1">Last Updated</p>
              <p className="text-white">{new Date(property.updatedAt).toLocaleDateString()}</p>
            </div>
            <div>
              <p className="text-sm text-dark-400 mb-1">Property ID</p>
              <p className="text-white font-mono">{property.id}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}


[FILE_END: src\app\properties\[id]\page.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\AIDealScoring.tsx
TYPE: TSX
SIZE: 12053 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface AIDealScoringProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
  onUpdateScore?: (propertyId: string, score: number) => void;
}

// Scoring factors with weights
interface ScoringFactor {
  name: string;
  weight: number;
  evaluate: (property: PropertyWithCalculations) => number;
}

const SCORING_FACTORS: ScoringFactor[] = [
  {
    name: 'Cap Rate',
    weight: 0.20,
    evaluate: (p) => {
      if (p.capRate >= 10) return 100;
      if (p.capRate >= 8) return 80;
      if (p.capRate >= 6) return 60;
      if (p.capRate >= 4) return 40;
      return 20;
    },
  },
  {
    name: 'Cash-on-Cash Return',
    weight: 0.20,
    evaluate: (p) => {
      if (p.cashOnCashReturn >= 20) return 100;
      if (p.cashOnCashReturn >= 15) return 80;
      if (p.cashOnCashReturn >= 10) return 60;
      if (p.cashOnCashReturn >= 5) return 40;
      return 20;
    },
  },
  {
    name: 'Equity Gap',
    weight: 0.15,
    evaluate: (p) => {
      const ratio = p.equityGap / p.listPrice;
      if (ratio >= 0.30) return 100;
      if (ratio >= 0.20) return 80;
      if (ratio >= 0.15) return 60;
      if (ratio >= 0.10) return 40;
      return 20;
    },
  },
  {
    name: '1% Rule',
    weight: 0.15,
    evaluate: (p) => p.onePercentRule ? 100 : 30,
  },
  {
    name: 'Gross Yield',
    weight: 0.10,
    evaluate: (p) => {
      if (p.grossYield >= 15) return 100;
      if (p.grossYield >= 12) return 80;
      if (p.grossYield >= 8) return 60;
      if (p.grossYield >= 5) return 40;
      return 20;
    },
  },
  {
    name: 'Price per SqFt',
    weight: 0.10,
    evaluate: (p) => {
      // Lower is better - compare to average of $150/sqft
      const avgPricePerSqft = 150;
      const ratio = p.pricePerSqft / avgPricePerSqft;
      if (ratio <= 0.7) return 100;
      if (ratio <= 0.85) return 80;
      if (ratio <= 1.0) return 60;
      if (ratio <= 1.2) return 40;
      return 20;
    },
  },
  {
    name: 'Decision Quality',
    weight: 0.10,
    evaluate: (p) => {
      switch (p.decision) {
        case 'Pass Platinum': return 100;
        case 'Pass Gold': return 85;
        case 'Pass Silver': return 70;
        case 'Caution': return 40;
        case 'Hard Fail': return 10;
        default: return 50;
      }
    },
  },
];

// Calculate overall score for a property
const calculateDealScore = (property: PropertyWithCalculations): number => {
  let totalWeight = 0;
  let weightedScore = 0;

  SCORING_FACTORS.forEach(factor => {
    const score = factor.evaluate(property);
    weightedScore += score * factor.weight;
    totalWeight += factor.weight;
  });

  return Math.round(weightedScore / totalWeight);
};

// Get risk level based on score
const getRiskLevel = (score: number): { label: string; color: string } => {
  if (score >= 80) return { label: 'Low Risk', color: 'text-emerald-400' };
  if (score >= 60) return { label: 'Medium Risk', color: 'text-amber-400' };
  if (score >= 40) return { label: 'High Risk', color: 'text-orange-400' };
  return { label: 'Very High Risk', color: 'text-red-400' };
};

export default function AIDealScoring({ 
  properties, 
  onPropertyClick,
  onUpdateScore 
}: AIDealScoringProps) {
  const [selectedPropertyId, setSelectedPropertyId] = useState<string | null>(null);
  const [showDetails, setShowDetails] = useState(false);

  // Calculate scores for all properties
  const scoredProperties = useMemo(() => {
    return properties.map(property => {
      const score = calculateDealScore(property);
      const risk = getRiskLevel(score);
      return {
        ...property,
        dealScore: score,
        riskLevel: risk.label,
        riskColor: risk.color,
      };
    }).sort((a, b) => b.dealScore - a.dealScore);
  }, [properties]);

  // Get selected property details
  const selectedProperty = useMemo(() => {
    if (!selectedPropertyId) return null;
    return scoredProperties.find(p => p.id === selectedPropertyId);
  }, [selectedPropertyId, scoredProperties]);

  // Calculate factor scores for selected property
  const factorScores = useMemo(() => {
    if (!selectedProperty) return [];
    return SCORING_FACTORS.map(factor => ({
      name: factor.name,
      weight: factor.weight,
      score: factor.evaluate(selectedProperty),
    }));
  }, [selectedProperty]);

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-dark-700">
        <div>
          <h2 className="text-lg font-bold text-white">AI Deal Scoring</h2>
          <p className="text-sm text-dark-400">Automated investment analysis</p>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={() => setShowDetails(!showDetails)}
            className={clsx(
              'px-3 py-1.5 rounded-lg text-sm font-medium transition-colors',
              showDetails 
                ? 'bg-primary-500 text-white' 
                : 'bg-dark-700 text-dark-300 hover:bg-dark-600'
            )}
          >
            {showDetails ? 'Hide Details' : 'Show Details'}
          </button>
        </div>
      </div>

      <div className="flex-1 overflow-auto p-4">
        {/* Score Distribution */}
        <div className="grid grid-cols-4 gap-3 mb-6">
          <div className="bg-dark-800 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-emerald-400">
              {scoredProperties.filter(p => p.dealScore >= 80).length}
            </p>
            <p className="text-xs text-dark-400">Excellent (80+)</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-blue-400">
              {scoredProperties.filter(p => p.dealScore >= 60 && p.dealScore < 80).length}
            </p>
            <p className="text-xs text-dark-400">Good (60-79)</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-amber-400">
              {scoredProperties.filter(p => p.dealScore >= 40 && p.dealScore < 60).length}
            </p>
            <p className="text-xs text-dark-400">Fair (40-59)</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-red-400">
              {scoredProperties.filter(p => p.dealScore < 40).length}
            </p>
            <p className="text-xs text-dark-400">Poor ({'<'}40)</p>
          </div>
        </div>

        {/* Property List */}
        <div className="space-y-2">
          {scoredProperties.slice(0, 15).map((property, index) => (
            <div
              key={property.id}
              onClick={() => setSelectedPropertyId(property.id)}
              className={clsx(
                'bg-dark-800 rounded-lg p-4 cursor-pointer transition-colors',
                selectedPropertyId === property.id 
                  ? 'ring-2 ring-primary-500' 
                  : 'hover:bg-dark-700'
              )}
            >
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className={clsx(
                    'w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold',
                    property.dealScore >= 80 ? 'bg-emerald-500/20 text-emerald-400' :
                    property.dealScore >= 60 ? 'bg-blue-500/20 text-blue-400' :
                    property.dealScore >= 40 ? 'bg-amber-500/20 text-amber-400' :
                    'bg-red-500/20 text-red-400'
                  )}>
                    {property.dealScore}
                  </div>
                  <div>
                    <p className="font-medium text-white">{property.address}</p>
                    <p className="text-sm text-dark-400">{property.city} • {property.strategy}</p>
                  </div>
                </div>
                <div className="text-right">
                  <p className={clsx('font-medium', property.riskColor)}>
                    {property.riskLevel}
                  </p>
                  <p className="text-sm text-dark-400">
                    ${property.listPrice.toLocaleString()}
                  </p>
                </div>
              </div>

              {/* Score Bar */}
              <div className="mt-3">
                <div className="h-2 bg-dark-700 rounded-full overflow-hidden">
                  <div 
                    className={clsx(
                      'h-full rounded-full transition-all',
                      property.dealScore >= 80 ? 'bg-emerald-500' :
                      property.dealScore >= 60 ? 'bg-blue-500' :
                      property.dealScore >= 40 ? 'bg-amber-500' :
                      'bg-red-500'
                    )}
                    style={{ width: `${property.dealScore}%` }}
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Detail Panel */}
      {selectedProperty && (
        <div className="p-4 border-t border-dark-700 bg-dark-800">
          <div className="flex justify-between items-start mb-4">
            <div>
              <h3 className="font-bold text-white">{selectedProperty.address}</h3>
              <p className="text-sm text-dark-400">{selectedProperty.city}, {selectedProperty.state}</p>
            </div>
            <button
              onClick={() => onPropertyClick?.(selectedProperty)}
              className="px-3 py-1.5 bg-primary-500 text-white rounded-lg text-sm hover:bg-primary-600 transition-colors"
            >
              View Property
            </button>
          </div>

          {showDetails && (
            <div className="space-y-2">
              {factorScores.map((factor, index) => (
                <div key={index} className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-dark-400">{factor.name}</span>
                    <span className="text-xs text-dark-500">({(factor.weight * 100).toFixed(0)}%)</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-20 h-1.5 bg-dark-700 rounded-full overflow-hidden">
                      <div 
                        className={clsx(
                          'h-full rounded-full',
                          factor.score >= 80 ? 'bg-emerald-500' :
                          factor.score >= 60 ? 'bg-blue-500' :
                          factor.score >= 40 ? 'bg-amber-500' :
                          'bg-red-500'
                        )}
                        style={{ width: `${factor.score}%` }}
                      />
                    </div>
                    <span className="text-sm text-white w-8 text-right">{factor.score}</span>
                  </div>
                </div>
              ))}
            </div>
          )}

          {!showDetails && (
            <div className="grid grid-cols-3 gap-4 text-sm">
              <div>
                <p className="text-dark-500">Cap Rate</p>
                <p className="text-white">{selectedProperty.capRate.toFixed(2)}%</p>
              </div>
              <div>
                <p className="text-dark-500">Cash-on-Cash</p>
                <p className="text-white">{selectedProperty.cashOnCashReturn.toFixed(2)}%</p>
              </div>
              <div>
                <p className="text-dark-500">Equity Gap</p>
                <p className="text-amber-400">${selectedProperty.equityGap.toLocaleString()}</p>
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );
}


[FILE_END: src\components\AIDealScoring.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\CollaborationHub.tsx
TYPE: TSX
SIZE: 9937 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface CollaborationHubProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
}

// Sample team members
interface TeamMember {
  id: string;
  name: string;
  email: string;
  role: string;
  avatar: string;
  status: 'online' | 'offline' | 'away';
}

// Sample comments
interface Comment {
  id: string;
  propertyId: string;
  userId: string;
  userName: string;
  userAvatar: string;
  content: string;
  createdAt: Date;
}

const SAMPLE_TEAM: TeamMember[] = [
  { id: '1', name: 'John Smith', email: 'john@example.com', role: 'Deal Lead', avatar: 'JS', status: 'online' },
  { id: '2', name: 'Sarah Wilson', email: 'sarah@example.com', role: 'Analyst', avatar: 'SW', status: 'online' },
  { id: '3', name: 'Mike Johnson', email: 'mike@example.com', role: 'Contractor', avatar: 'MJ', status: 'away' },
  { id: '4', name: 'Emily Brown', email: 'emily@example.com', role: 'Investor', avatar: 'EB', status: 'offline' },
];

const SAMPLE_COMMENTS: Comment[] = [
  {
    id: '1',
    propertyId: '1',
    userId: '1',
    userName: 'John Smith',
    userAvatar: 'JS',
    content: 'This property looks great! The cap rate is above our target.',
    createdAt: new Date(Date.now() - 3600000),
  },
  {
    id: '2',
    propertyId: '1',
    userId: '2',
    userName: 'Sarah Wilson',
    userAvatar: 'SW',
    content: 'I agree. The neighborhood is up and coming with new developments.',
    createdAt: new Date(Date.now() - 1800000),
  },
  {
    id: '3',
    propertyId: '2',
    userId: '3',
    userName: 'Mike Johnson',
    userAvatar: 'MJ',
    content: 'Rehab estimate looks realistic. Can start in 2 weeks.',
    createdAt: new Date(Date.now() - 7200000),
  },
];

export default function CollaborationHub({ properties, onPropertyClick }: CollaborationHubProps) {
  const [activeTab, setActiveTab] = useState<'comments' | 'team' | 'activity'>('comments');
  const [selectedPropertyId, setSelectedPropertyId] = useState<string | null>(null);
  const [newComment, setNewComment] = useState('');

  // Filter comments by selected property
  const filteredComments = useMemo(() => {
    if (!selectedPropertyId) return SAMPLE_COMMENTS;
    return SAMPLE_COMMENTS.filter(c => c.propertyId === selectedPropertyId);
  }, [selectedPropertyId]);

  // Get comments count per property
  const commentCounts = useMemo(() => {
    const counts: Record<string, number> = {};
    SAMPLE_COMMENTS.forEach(c => {
      counts[c.propertyId] = (counts[c.propertyId] || 0) + 1;
    });
    return counts;
  }, []);

  // Format time ago
  const formatTimeAgo = (date: Date): string => {
    const diff = Date.now() - date.getTime();
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    
    if (minutes < 60) return `${minutes}m ago`;
    if (hours < 24) return `${hours}h ago`;
    return `${Math.floor(hours / 24)}d ago`;
  };

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="p-4 border-b border-dark-700">
        <h2 className="text-lg font-bold text-white">Collaboration Hub</h2>
        <p className="text-sm text-dark-400">Team communication and activity</p>
      </div>

      {/* Tabs */}
      <div className="flex border-b border-dark-700">
        {(['comments', 'team', 'activity'] as const).map((tab) => (
          <button
            key={tab}
            onClick={() => setActiveTab(tab)}
            className={clsx(
              'flex-1 py-3 text-sm font-medium transition-colors capitalize',
              activeTab === tab
                ? 'text-primary-400 border-b-2 border-primary-400'
                : 'text-dark-400 hover:text-white'
            )}
          >
            {tab}
          </button>
        ))}
      </div>

      <div className="flex-1 overflow-auto">
        {/* Comments Tab */}
        {activeTab === 'comments' && (
          <div className="p-4">
            {/* Property Filter */}
            <div className="mb-4">
              <label className="text-xs text-dark-500 block mb-2">Filter by Property</label>
              <select
                value={selectedPropertyId || ''}
                onChange={(e) => setSelectedPropertyId(e.target.value || null)}
                className="w-full px-3 py-2 bg-dark-800 border border-dark-700 rounded text-white"
              >
                <option value="">All Properties</option>
                {properties.slice(0, 10).map((p) => (
                  <option key={p.id} value={p.id}>
                    {p.address.substring(0, 30)}...
                  </option>
                ))}
              </select>
            </div>

            {/* Comments List */}
            <div className="space-y-3 mb-4">
              {filteredComments.map((comment) => (
                <div key={comment.id} className="bg-dark-800 rounded-lg p-3">
                  <div className="flex items-start gap-3">
                    <div className="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-xs font-bold text-white">
                      {comment.userAvatar}
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center justify-between">
                        <span className="font-medium text-white text-sm">{comment.userName}</span>
                        <span className="text-xs text-dark-500">{formatTimeAgo(comment.createdAt)}</span>
                      </div>
                      <p className="text-sm text-dark-400 mt-1">{comment.content}</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            {/* New Comment */}
            <div className="flex gap-2">
              <input
                type="text"
                value={newComment}
                onChange={(e) => setNewComment(e.target.value)}
                placeholder="Add a comment..."
                className="flex-1 px-3 py-2 bg-dark-800 border border-dark-700 rounded text-white"
              />
              <button
                className="px-4 py-2 bg-primary-500 text-white rounded hover:bg-primary-600 transition-colors"
                onClick={() => {
                  if (newComment.trim()) {
                    setNewComment('');
                  }
                }}
              >
                Send
              </button>
            </div>
          </div>
        )}

        {/* Team Tab */}
        {activeTab === 'team' && (
          <div className="p-4">
            <div className="space-y-2">
              {SAMPLE_TEAM.map((member) => (
                <div 
                  key={member.id} 
                  className="bg-dark-800 rounded-lg p-3 flex items-center gap-3"
                >
                  <div className="relative">
                    <div className="w-10 h-10 rounded-full bg-dark-600 flex items-center justify-center text-sm font-bold text-white">
                      {member.avatar}
                    </div>
                    <div className={clsx(
                      'absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-dark-800',
                      member.status === 'online' ? 'bg-emerald-400' :
                      member.status === 'away' ? 'bg-amber-400' : 'bg-dark-500'
                    )} />
                  </div>
                  <div className="flex-1">
                    <p className="font-medium text-white">{member.name}</p>
                    <p className="text-sm text-dark-400">{member.role}</p>
                  </div>
                  <button className="px-3 py-1 bg-dark-700 rounded text-sm text-dark-400 hover:text-white transition-colors">
                    Message
                  </button>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Activity Tab */}
        {activeTab === 'activity' && (
          <div className="p-4">
            <div className="relative">
              {/* Timeline line */}
              <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-dark-700" />
              
              <div className="space-y-4">
                {[
                  { user: 'John Smith', action: 'added a comment', target: '123 Main St', time: '10 minutes ago' },
                  { user: 'Sarah Wilson', action: 'updated deal score', target: '456 Oak Ave', time: '25 minutes ago' },
                  { user: 'Mike Johnson', action: 'uploaded photos', target: '789 Pine Rd', time: '1 hour ago' },
                  { user: 'Emily Brown', action: 'marked as favorite', target: '321 Elm St', time: '2 hours ago' },
                  { user: 'John Smith', action: 'changed strategy to BRRR', target: '654 Maple Dr', time: '3 hours ago' },
                ].map((activity, index) => (
                  <div key={index} className="flex items-start gap-3 relative">
                    <div className="w-2 h-2 rounded-full bg-primary-500 z-10 mt-2" />
                    <div className="flex-1 bg-dark-800 rounded-lg p-3">
                      <p className="text-sm">
                        <span className="font-medium text-white">{activity.user}</span>
                        {' '}
                        <span className="text-dark-400">{activity.action}</span>
                        {' '}
                        <span className="text-primary-400">{activity.target}</span>
                      </p>
                      <p className="text-xs text-dark-500 mt-1">{activity.time}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}


[FILE_END: src\components\CollaborationHub.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\DashboardClient.tsx
TYPE: TSX
SIZE: 7042 bytes
================================================================================
'use client';

import { useState, useMemo, useEffect } from 'react';
import dynamic from 'next/dynamic';
import Sidebar, { ViewType } from '@/components/Sidebar';
import { useProperties, PropertyWithCalculations } from '@/context/PropertyContext';
import ValueScatterPlot from '@/components/ValueScatterPlot';
import StrategyKanban from '@/components/StrategyKanban';
import PropertyDataTable from '@/components/PropertyDataTable';

// Dynamic import for the map component - critical for bundle size optimization
// Heavy mapping libraries (like Leaflet) shouldn't block initial page load
const OpportunityMap = dynamic(() => import('@/components/OpportunityMap'), {
  ssr: false,
  loading: () => (
    <div className="w-full h-full bg-dark-800 animate-pulse rounded-lg" />
  ),
});

/**
 * DashboardClient Component
 * 
 * Main dashboard that displays property data in various views.
 * Uses PropertyContext for data - no longer receives initialProperties as props
 * to avoid the "double fetch" pattern.
 */
export default function DashboardClient() {
  // Get properties from context (initialized with server-side data)
  const { properties, loading, error, toggleFavorite, isFavorite } = useProperties();
  
  const [currentView, setCurrentView] = useState<ViewType>('map');
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedProperty, setSelectedProperty] = useState<PropertyWithCalculations | null>(null);
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const checkMobile = () => setIsMobile(window.innerWidth < 768);
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  // Filter properties based on search query
  // Uses useMemo to prevent expensive re-renders when only selectedProperty changes
  const filteredProperties = useMemo(() => {
    if (!searchQuery.trim()) return properties;

    const lower = searchQuery.toLowerCase();
    return properties.filter(p =>
       p.address.toLowerCase().includes(lower) ||
       p.rationale.toLowerCase().includes(lower) ||
       p.city.toLowerCase().includes(lower) ||
       (p.details?.toLowerCase().includes(lower) ?? false)
    );
  }, [searchQuery, properties]);

  // Calculate stats for sidebar
  const stats = useMemo(() => {
    return {
      total: filteredProperties.length,
      platinum: filteredProperties.filter(p => p.decision === 'Pass Platinum').length,
    };
  }, [filteredProperties]);

  const handlePropertyClick = (property: PropertyWithCalculations) => {
    setSelectedProperty(property);
  };

  const renderView = () => {
    // Show loading skeleton for table view
    if (loading && currentView === 'table') {
      return <PropertyTableSkeleton />;
    }
    
    switch (currentView) {
      case 'map': 
        return <OpportunityMap properties={filteredProperties} onPropertyClick={handlePropertyClick} />;
      case 'scatter': 
        return <ValueScatterPlot properties={filteredProperties} onPropertyClick={handlePropertyClick} />;
      case 'kanban': 
        return <StrategyKanban properties={filteredProperties} onPropertyClick={handlePropertyClick} />;
      case 'table': 
        return (
          <PropertyDataTable 
            properties={filteredProperties} 
            onPropertyClick={handlePropertyClick}
            onToggleFavorite={toggleFavorite}
            getIsFavorite={isFavorite}
          />
        );
      default: 
        return null;
    }
  };

  const getViewTitle = () => {
    switch (currentView) {
      case 'map': return 'Geospatial Opportunity Map';
      case 'scatter': return 'Value Analysis Scatter Plot';
      case 'kanban': return 'Strategy Workflow Board';
      case 'table': return 'Interactive Data Grid';
      default: return '';
    }
  };

  const getViewDescription = () => {
    switch (currentView) {
      case 'map': return 'Color-coded markers indicate deal quality. Click markers for property details.';
      case 'scatter': return 'Identify value opportunities below the average price/sqft trend line.';
      case 'kanban': return 'Properties organized by investment strategy with equity gap analysis.';
      case 'table': return 'Sort, filter, and analyze properties with computed investment metrics.';
      default: return '';
    }
  };

  // Show error state
  if (error) {
    return (
      <div className="flex h-screen bg-dark-950 items-center justify-center">
        <div className="text-center">
          <h2 className="text-xl font-bold text-red-400 mb-2">Error Loading Properties</h2>
          <p className="text-dark-400">{error}</p>
        </div>
      </div>
    );
  }

  return (
    <div className="flex h-screen bg-dark-950">
      <Sidebar
        currentView={currentView}
        onViewChange={setCurrentView}
        searchQuery={searchQuery}
        onSearchChange={setSearchQuery}
        propertyCount={stats.total}
        platinumCount={stats.platinum}
      />
      <main className={`flex-1 overflow-hidden ${isMobile ? 'pt-0' : 'ml-64 p-6'}`}>
        <div className={`${isMobile ? 'p-4' : 'mb-6'}`}>
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
            <div>
              <h1 className="text-xl md:text-2xl font-bold text-white">{getViewTitle()}</h1>
              <p className="text-dark-400 mt-1 text-sm md:text-base">{getViewDescription()}</p>
            </div>
            <div className="flex items-center gap-2 md:gap-4">
              <div className="text-xs md:text-sm text-dark-400">
                Source: Live Database
              </div>
              {loading && (
                <div className="text-xs md:text-sm text-blue-400 animate-pulse">
                  Loading...
                </div>
              )}
            </div>
          </div>
        </div>
        <div className={`${isMobile ? 'h-[calc(100vh-180px)] px-4 pb-4' : 'h-[calc(100vh-180px)]'}`}>
          {renderView()}
        </div>
      </main>
    </div>
  );
}

/**
 * Skeleton component for the property table.
 * Shows shimmering rows to maintain layout integrity during loading.
 */
function PropertyTableSkeleton() {
  return (
    <div className="w-full h-full bg-dark-800 rounded-lg overflow-hidden">
      <div className="p-4 border-b border-dark-700">
        <div className="h-6 w-48 bg-dark-700 rounded animate-pulse" />
      </div>
      <div className="divide-y divide-dark-700">
        {Array.from({ length: 8 }).map((_, i) => (
          <div key={i} className="p-4 flex gap-4">
            <div className="h-4 w-32 bg-dark-700 rounded animate-pulse" />
            <div className="h-4 w-24 bg-dark-700 rounded animate-pulse" />
            <div className="h-4 w-20 bg-dark-700 rounded animate-pulse" />
            <div className="h-4 w-16 bg-dark-700 rounded animate-pulse" />
            <div className="h-4 w-28 bg-dark-700 rounded animate-pulse ml-auto" />
          </div>
        ))}
      </div>
    </div>
  );
}


[FILE_END: src\components\DashboardClient.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\ExpenseTracker.tsx
TYPE: TSX
SIZE: 2213 bytes
================================================================================
'use client';
import { useState } from 'react';

export default function ExpenseTracker({ budget }: { budget: number }) {
  const [expenses, setExpenses] = useState<{id: string, category: string, amount: number}[]>([]);
  const [amount, setAmount] = useState('');
  const [category, setCategory] = useState('');

  const addExpense = () => {
    if (!amount) return;
    setExpenses([...expenses, { id: Date.now().toString(), category, amount: Number(amount) }]);
    setAmount('');
  };

  const totalSpent = expenses.reduce((sum, e) => sum + e.amount, 0);

  return (
    <div className="bg-dark-800 p-6 rounded-lg border border-dark-700">
      <h3 className="text-lg font-semibold text-white mb-4">Rehab Budget</h3>
      <div className="grid grid-cols-2 gap-4 mb-4">
        <div className="p-3 bg-dark-700 rounded">
          <div className="text-xs text-dark-400">Budget</div>
          <div className="text-lg font-bold text-white">${budget.toLocaleString()}</div>
        </div>
        <div className="p-3 bg-dark-700 rounded">
          <div className="text-xs text-dark-400">Remaining</div>
          <div className="text-lg font-bold text-emerald-400">${(budget - totalSpent).toLocaleString()}</div>
        </div>
      </div>
      
      <div className="flex gap-2 mb-4">
        <input 
          className="bg-dark-900 border border-dark-600 rounded p-2 text-sm text-white w-1/2"
          placeholder="Category"
          value={category}
          onChange={(e) => setCategory(e.target.value)}
        />
        <input 
          className="bg-dark-900 border border-dark-600 rounded p-2 text-sm text-white w-1/2"
          type="number"
          placeholder="Amount"
          value={amount}
          onChange={(e) => setAmount(e.target.value)}
        />
        <button onClick={addExpense} className="bg-primary-600 px-4 rounded text-white text-sm">Add</button>
      </div>

      <div className="space-y-2">
        {expenses.map(e => (
          <div key={e.id} className="flex justify-between text-sm text-dark-300 border-b border-dark-700 pb-1">
            <span>{e.category}</span>
            <span>-${e.amount}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

[FILE_END: src\components\ExpenseTracker.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\ExportReports.tsx
TYPE: TSX
SIZE: 13894 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface ExportReportsProps {
  properties: PropertyWithCalculations[];
  onClose?: () => void;
}

type ExportFormat = 'csv' | 'json' | 'pdf';
type ReportType = 'deal-analysis' | 'portfolio-summary' | 'market-comparison' | 'equity-report';

export default function ExportReports({ properties, onClose }: ExportReportsProps) {
  const [selectedFormat, setSelectedFormat] = useState<ExportFormat>('csv');
  const [selectedReport, setSelectedReport] = useState<ReportType>('deal-analysis');
  const [isExporting, setIsExporting] = useState(false);

  // Export to CSV
  const exportToCSV = () => {
    const headers = [
      'Address', 'City', 'State', 'Zip', 'List Price', 'Equity Gap', 
      'Sq Ft', 'Bedrooms', 'Bathrooms', 'Cap Rate', 'Cash-on-Cash', 
      'MAO', 'Gross Yield', '1% Rule', 'Decision', 'Strategy', 
      'Estimated Rent', 'Annual Taxes', 'Renovation Budget', 'ARV'
    ];

    const rows = properties.map(p => [
      p.address,
      p.city,
      p.state,
      p.zip,
      p.listPrice,
      p.equityGap,
      p.sqft,
      p.bedrooms,
      p.bathrooms,
      p.capRate,
      p.cashOnCashReturn,
      p.mao,
      p.grossYield,
      p.onePercentRule ? 'Yes' : 'No',
      p.decision,
      p.strategy,
      p.estimatedRent,
      p.annualTaxes,
      p.renovationBudget,
      p.afterRepairValue,
    ]);

    const csvContent = [
      headers.join(','),
      ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `property-export-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
    URL.revokeObjectURL(url);
  };

  // Export to JSON
  const exportToJSON = () => {
    const jsonContent = JSON.stringify(properties, null, 2);
    const blob = new Blob([jsonContent], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `property-export-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    URL.revokeObjectURL(url);
  };

  // Generate report based on selected type
  const generateReport = useMemo(() => {
    switch (selectedReport) {
      case 'deal-analysis':
        return {
          title: 'Deal Analysis Report',
          sections: [
            {
              name: 'Summary',
              data: [
                { label: 'Total Properties', value: properties.length.toString() },
                { label: 'Average Cap Rate', value: `${(properties.reduce((sum, p) => sum + p.capRate, 0) / properties.length).toFixed(2)}%` },
                { label: 'Average Cash-on-Cash', value: `${(properties.reduce((sum, p) => sum + p.cashOnCashReturn, 0) / properties.length).toFixed(2)}%` },
                { label: 'Total Equity Gap', value: `$${properties.reduce((sum, p) => sum + p.equityGap, 0).toLocaleString()}` },
              ],
            },
            {
              name: 'Top Deals by Cap Rate',
              data: properties
                .sort((a, b) => b.capRate - a.capRate)
                .slice(0, 5)
                .map(p => ({ 
                  label: p.address, 
                  value: `${p.capRate.toFixed(2)}% cap, $${p.equityGap.toLocaleString()} equity` 
                })),
            },
            {
              name: 'Properties Passing 1% Rule',
              data: [
                { label: 'Count', value: properties.filter(p => p.onePercentRule).length.toString() },
                { label: 'Percentage', value: `${((properties.filter(p => p.onePercentRule).length / properties.length) * 100).toFixed(1)}%` },
              ],
            },
          ],
        };

      case 'portfolio-summary':
        return {
          title: 'Portfolio Summary',
          sections: [
            {
              name: 'Holdings',
              data: [
                { label: 'Total Properties', value: properties.length.toString() },
                { label: 'Total List Value', value: `$${properties.reduce((sum, p) => sum + p.listPrice, 0).toLocaleString()}` },
                { label: 'Total Equity Gap', value: `$${properties.reduce((sum, p) => sum + p.equityGap, 0).toLocaleString()}` },
                { label: 'Monthly Rent Potential', value: `$${properties.reduce((sum, p) => sum + p.estimatedRent, 0).toLocaleString()}` },
              ],
            },
            {
              name: 'Strategy Distribution',
              data: Object.entries(
                properties.reduce((acc, p) => {
                  acc[p.strategy] = (acc[p.strategy] || 0) + 1;
                  return acc;
                }, {} as Record<string, number>)
              ).map(([strategy, count]) => ({ label: strategy, value: count.toString() })),
            },
            {
              name: 'Decision Breakdown',
              data: Object.entries(
                properties.reduce((acc, p) => {
                  acc[p.decision] = (acc[p.decision] || 0) + 1;
                  return acc;
                }, {} as Record<string, number>)
              ).map(([decision, count]) => ({ label: decision, value: count.toString() })),
            },
          ],
        };

      case 'market-comparison':
        return {
          title: 'Market Comparison',
          sections: [
            {
              name: 'Price Analysis',
              data: [
                { label: 'Average Price', value: `$${Math.round(properties.reduce((sum, p) => sum + p.listPrice, 0) / properties.length).toLocaleString()}` },
                { label: 'Highest Price', value: `$${Math.max(...properties.map(p => p.listPrice)).toLocaleString()}` },
                { label: 'Lowest Price', value: `$${Math.min(...properties.map(p => p.listPrice)).toLocaleString()}` },
                { label: 'Average $/SqFt', value: `$${(properties.reduce((sum, p) => sum + p.pricePerSqft, 0) / properties.length).toFixed(2)}` },
              ],
            },
            {
              name: 'Geographic Distribution',
              data: Object.entries(
                properties.reduce((acc, p) => {
                  acc[p.city] = (acc[p.city] || 0) + 1;
                  return acc;
                }, {} as Record<string, number>)
              ).map(([city, count]) => ({ label: city, value: count.toString() })),
            },
          ],
        };

      case 'equity-report':
        return {
          title: 'Equity Analysis Report',
          sections: [
            {
              name: 'Equity Summary',
              data: [
                { label: 'Total Equity Gap', value: `$${properties.reduce((sum, p) => sum + p.equityGap, 0).toLocaleString()}` },
                { label: 'Average Equity per Property', value: `$${Math.round(properties.reduce((sum, p) => sum + p.equityGap, 0) / properties.length).toLocaleString()}` },
              ],
            },
            {
              name: 'Top Equity Opportunities',
              data: properties
                .sort((a, b) => b.equityGap - a.equityGap)
                .slice(0, 10)
                .map(p => ({ 
                  label: p.address, 
                  value: `$${p.equityGap.toLocaleString()}` 
                })),
            },
          ],
        };

      default:
        return null;
    }
  }, [properties, selectedReport]);

  // Handle export
  const handleExport = async () => {
    setIsExporting(true);
    
    try {
      await new Promise(resolve => setTimeout(resolve, 500)); // Simulate processing
      
      switch (selectedFormat) {
        case 'csv':
          exportToCSV();
          break;
        case 'json':
          exportToJSON();
          break;
        case 'pdf':
          // For PDF, we'd typically use a library like jspdf
          // For now, we'll export as a formatted text file
          const reportText = generateReport ? JSON.stringify(generateReport, null, 2) : '';
          const blob = new Blob([reportText], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `report-${selectedReport}-${new Date().toISOString().split('T')[0]}.txt`;
          link.click();
          URL.revokeObjectURL(url);
          break;
      }
    } finally {
      setIsExporting(false);
    }
  };

  const reportTypes: { id: ReportType; label: string; description: string }[] = [
    { id: 'deal-analysis', label: 'Deal Analysis', description: 'Cap rates, cash-on-cash, 1% rule analysis' },
    { id: 'portfolio-summary', label: 'Portfolio Summary', description: 'Holdings, strategy distribution, totals' },
    { id: 'market-comparison', label: 'Market Comparison', description: 'Price analysis, geographic breakdown' },
    { id: 'equity-report', label: 'Equity Report', description: 'Equity gap analysis and opportunities' },
  ];

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-dark-700">
        <div>
          <h2 className="text-lg font-bold text-white">Export & Reports</h2>
          <p className="text-sm text-dark-400">Export data or generate reports</p>
        </div>
        {onClose && (
          <button
            onClick={onClose}
            className="p-2 text-dark-400 hover:text-white transition-colors"
          >
            ✕
          </button>
        )}
      </div>

      <div className="flex-1 overflow-auto p-4">
        {/* Export Section */}
        <div className="mb-6">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Quick Export
          </h3>
          
          <div className="grid grid-cols-3 gap-3">
            {(['csv', 'json', 'pdf'] as ExportFormat[]).map((format) => (
              <button
                key={format}
                onClick={() => setSelectedFormat(format)}
                className={clsx(
                  'p-4 rounded-lg text-center transition-colors',
                  selectedFormat === format
                    ? 'bg-primary-500 text-white'
                    : 'bg-dark-800 text-dark-300 hover:bg-dark-700'
                )}
              >
                <div className="text-2xl mb-1">
                  {format === 'csv' && '📊'}
                  {format === 'json' && '📄'}
                  {format === 'pdf' && '📑'}
                </div>
                <span className="text-sm font-medium uppercase">{format}</span>
              </button>
            ))}
          </div>
        </div>

        {/* Report Section */}
        <div className="mb-6">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Generate Report
          </h3>
          
          <div className="space-y-2">
            {reportTypes.map((report) => (
              <button
                key={report.id}
                onClick={() => setSelectedReport(report.id)}
                className={clsx(
                  'w-full p-4 rounded-lg text-left transition-colors',
                  selectedReport === report.id
                    ? 'bg-primary-500/20 border border-primary-500'
                    : 'bg-dark-800 border border-transparent hover:border-dark-600'
                )}
              >
                <p className="font-medium text-white">{report.label}</p>
                <p className="text-sm text-dark-400">{report.description}</p>
              </button>
            ))}
          </div>
        </div>

        {/* Report Preview */}
        {generateReport && (
          <div className="mb-6">
            <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
              Report Preview
            </h3>
            
            <div className="bg-dark-800 rounded-lg p-4">
              <h4 className="text-lg font-bold text-white mb-4">{generateReport.title}</h4>
              
              {generateReport.sections.map((section, sectionIndex) => (
                <div key={sectionIndex} className="mb-4 last:mb-0">
                  <h5 className="text-sm font-medium text-primary-400 mb-2">{section.name}</h5>
                  <div className="space-y-1">
                    {section.data.map((item, itemIndex) => (
                      <div key={itemIndex} className="flex justify-between text-sm">
                        <span className="text-dark-400">{item.label}</span>
                        <span className="text-white font-medium">{item.value}</span>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>

      {/* Export Button */}
      <div className="p-4 border-t border-dark-700">
        <button
          onClick={handleExport}
          disabled={isExporting}
          className={clsx(
            'w-full py-3 rounded-lg font-medium transition-colors',
            isExporting
              ? 'bg-dark-700 text-dark-400 cursor-not-allowed'
              : 'bg-primary-500 text-white hover:bg-primary-600'
          )}
        >
          {isExporting ? (
            <span className="flex items-center justify-center gap-2">
              <span className="animate-spin">⏳</span>
              Exporting...
            </span>
          ) : (
            `Export ${selectedFormat.toUpperCase()} (${properties.length} properties)`
          )}
        </button>
      </div>
    </div>
  );
}


[FILE_END: src\components\ExportReports.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\FinancialProjections.tsx
TYPE: TSX
SIZE: 12177 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface FinancialProjectionsProps {
  property: PropertyWithCalculations | null;
  onClose?: () => void;
}

interface ProjectionYear {
  year: number;
  grossRent: number;
  vacancy: number;
  effectiveGross: number;
  operatingExpenses: number;
  noi: number;
  mortgage: number;
  cashFlow: number;
  equityBuild: number;
  totalReturn: number;
}

interface LoanDetails {
  downPaymentPercent: number;
  interestRate: number;
  loanTermYears: number;
}

const DEFAULT_LOAN: LoanDetails = {
  downPaymentPercent: 20,
  interestRate: 7.0,
  loanTermYears: 30,
};

// Calculate monthly mortgage payment
const calculateMortgage = (
  principal: number, 
  annualRate: number, 
  years: number
): number => {
  const monthlyRate = annualRate / 100 / 12;
  const numPayments = years * 12;
  if (monthlyRate === 0) return principal / numPayments;
  return (principal * monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
    (Math.pow(1 + monthlyRate, numPayments) - 1);
};

export default function FinancialProjections({ property, onClose }: FinancialProjectionsProps) {
  const [loanDetails, setLoanDetails] = useState<LoanDetails>(DEFAULT_LOAN);
  const [projectionYears, setProjectionYears] = useState(5);
  const [rentGrowthRate, setRentGrowthRate] = useState(3);
  const [appreciationRate, setAppreciationRate] = useState(3);
  const [expenseGrowthRate, setExpenseGrowthRate] = useState(2);

  // Calculate projections
  const projections = useMemo((): ProjectionYear[] => {
    if (!property) return [];

    const purchasePrice = property.listPrice;
    const downPayment = purchasePrice * (loanDetails.downPaymentPercent / 100);
    const loanAmount = purchasePrice - downPayment;
    const monthlyMortgage = calculateMortgage(loanAmount, loanDetails.interestRate, loanDetails.loanTermYears);
    const annualMortgage = monthlyMortgage * 12;

    // Initial values
    let grossRent = (property.estimatedRent || 0) * 12;
    const vacancyRate = 0.05;
    const operatingExpensesRate = 0.40; // 40% of gross rent
    let currentPropertyValue = purchasePrice + (property.afterRepairValue - property.listPrice);

    const results: ProjectionYear[] = [];

    for (let year = 1; year <= projectionYears; year++) {
      // Apply growth rates
      if (year > 1) {
        grossRent *= (1 + rentGrowthRate / 100);
        currentPropertyValue *= (1 + appreciationRate / 100);
      }

      const vacancy = grossRent * vacancyRate;
      const effectiveGross = grossRent - vacancy;
      const operatingExpenses = effectiveGross * operatingExpensesRate;
      const noi = effectiveGross - operatingExpenses;
      const cashFlow = noi - annualMortgage;

      // Equity buildup (principal paydown + appreciation)
      // Simplified: assume 80% of first year's payment goes to interest
      const firstYearInterest = loanAmount * (loanDetails.interestRate / 100);
      const firstYearPrincipal = annualMortgage - firstYearInterest;
      // Simplified equity build calculation
      const equityBuild = firstYearPrincipal * Math.pow(1.05, year - 1) + 
        (currentPropertyValue - purchasePrice) * 0.1; // Simplified

      const totalReturn = cashFlow + equityBuild;

      results.push({
        year,
        grossRent: Math.round(grossRent),
        vacancy: Math.round(vacancy),
        effectiveGross: Math.round(effectiveGross),
        operatingExpenses: Math.round(operatingExpenses),
        noi: Math.round(noi),
        mortgage: Math.round(annualMortgage),
        cashFlow: Math.round(cashFlow),
        equityBuild: Math.round(equityBuild),
        totalReturn: Math.round(totalReturn),
      });
    }

    return results;
  }, [property, loanDetails, projectionYears, rentGrowthRate, appreciationRate, expenseGrowthRate]);

  // Summary metrics
  const summary = useMemo(() => {
    if (projections.length === 0) return null;

    const totalCashFlow = projections.reduce((sum, p) => sum + p.cashFlow, 0);
    const totalEquityBuild = projections.reduce((sum, p) => sum + p.equityBuild, 0);
    const avgCashFlow = totalCashFlow / projections.length;
    const cashOnCash = (avgCashFlow / (property?.listPrice || 1) * loanDetails.downPaymentPercent / 100) * 100;

    return {
      totalCashFlow,
      totalEquityBuild,
      totalReturn: totalCashFlow + totalEquityBuild,
      avgCashFlow,
      cashOnCash: Math.round(cashOnCash * 100) / 100,
    };
  }, [projections, property, loanDetails]);

  if (!property) {
    return (
      <div className="w-full h-full flex items-center justify-center bg-dark-900 rounded-lg">
        <div className="text-center text-dark-400">
          <p className="text-lg mb-2">No property selected</p>
          <p className="text-sm">Select a property to view financial projections</p>
        </div>
      </div>
    );
  }

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-dark-700">
        <div>
          <h2 className="text-lg font-bold text-white">Financial Projections</h2>
          <p className="text-sm text-dark-400">{property.address}</p>
        </div>
        {onClose && (
          <button
            onClick={onClose}
            className="p-2 text-dark-400 hover:text-white transition-colors"
          >
            ✕
          </button>
        )}
      </div>

      <div className="flex-1 overflow-auto p-4">
        {/* Loan Details */}
        <div className="bg-dark-800 rounded-lg p-4 mb-4">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Loan Assumptions
          </h3>
          
          <div className="grid grid-cols-3 gap-4 mb-4">
            <div>
              <label className="text-xs text-dark-500 block mb-1">Down Payment %</label>
              <input
                type="number"
                value={loanDetails.downPaymentPercent}
                onChange={(e) => setLoanDetails(prev => ({ ...prev, downPaymentPercent: Number(e.target.value) }))}
                className="w-full px-3 py-2 bg-dark-700 border border-dark-600 rounded text-white"
              />
            </div>
            <div>
              <label className="text-xs text-dark-500 block mb-1">Interest Rate %</label>
              <input
                type="number"
                step="0.1"
                value={loanDetails.interestRate}
                onChange={(e) => setLoanDetails(prev => ({ ...prev, interestRate: Number(e.target.value) }))}
                className="w-full px-3 py-2 bg-dark-700 border border-dark-600 rounded text-white"
              />
            </div>
            <div>
              <label className="text-xs text-dark-500 block mb-1">Loan Term (Years)</label>
              <input
                type="number"
                value={loanDetails.loanTermYears}
                onChange={(e) => setLoanDetails(prev => ({ ...prev, loanTermYears: Number(e.target.value) }))}
                className="w-full px-3 py-2 bg-dark-700 border border-dark-600 rounded text-white"
              />
            </div>
          </div>

          <div className="grid grid-cols-3 gap-4">
            <div>
              <label className="text-xs text-dark-500 block mb-1">Rent Growth %</label>
              <input
                type="number"
                value={rentGrowthRate}
                onChange={(e) => setRentGrowthRate(Number(e.target.value))}
                className="w-full px-3 py-2 bg-dark-700 border border-dark-600 rounded text-white"
              />
            </div>
            <div>
              <label className="text-xs text-dark-500 block mb-1">Appreciation %</label>
              <input
                type="number"
                value={appreciationRate}
                onChange={(e) => setAppreciationRate(Number(e.target.value))}
                className="w-full px-3 py-2 bg-dark-700 border border-dark-600 rounded text-white"
              />
            </div>
            <div>
              <label className="text-xs text-dark-500 block mb-1">Years</label>
              <input
                type="number"
                max="10"
                value={projectionYears}
                onChange={(e) => setProjectionYears(Number(e.target.value))}
                className="w-full px-3 py-2 bg-dark-700 border border-dark-600 rounded text-white"
              />
            </div>
          </div>
        </div>

        {/* Summary */}
        {summary && (
          <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
            <div className="bg-dark-800 rounded-lg p-3">
              <p className="text-xs text-dark-400">Total Cash Flow</p>
              <p className={clsx(
                'text-lg font-bold',
                summary.totalCashFlow > 0 ? 'text-emerald-400' : 'text-red-400'
              )}>
                ${summary.totalCashFlow.toLocaleString()}
              </p>
            </div>
            <div className="bg-dark-800 rounded-lg p-3">
              <p className="text-xs text-dark-400">Equity Built</p>
              <p className="text-lg font-bold text-blue-400">
                ${summary.totalEquityBuild.toLocaleString()}
              </p>
            </div>
            <div className="bg-dark-800 rounded-lg p-3">
              <p className="text-xs text-dark-400">Total Return</p>
              <p className="text-lg font-bold text-primary-400">
                ${summary.totalReturn.toLocaleString()}
              </p>
            </div>
            <div className="bg-dark-800 rounded-lg p-3">
              <p className="text-xs text-dark-400">Cash-on-Cash</p>
              <p className="text-lg font-bold text-amber-400">
                {summary.cashOnCash.toFixed(2)}%
              </p>
            </div>
          </div>
        )}

        {/* Projection Table */}
        <div className="bg-dark-800 rounded-lg overflow-hidden">
          <table className="w-full">
            <thead className="bg-dark-700">
              <tr>
                <th className="px-3 py-2 text-left text-xs font-semibold text-dark-400">Year</th>
                <th className="px-3 py-2 text-right text-xs font-semibold text-dark-400">Gross Rent</th>
                <th className="px-3 py-2 text-right text-xs font-semibold text-dark-400">NOI</th>
                <th className="px-3 py-2 text-right text-xs font-semibold text-dark-400">Mortgage</th>
                <th className="px-3 py-2 text-right text-xs font-semibold text-dark-400">Cash Flow</th>
                <th className="px-3 py-2 text-right text-xs font-semibold text-dark-400">Equity</th>
                <th className="px-3 py-2 text-right text-xs font-semibold text-dark-400">Total Return</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-dark-700">
              {projections.map((proj) => (
                <tr key={proj.year} className="hover:bg-dark-700">
                  <td className="px-3 py-2 text-white font-medium">Year {proj.year}</td>
                  <td className="px-3 py-2 text-right text-white">${proj.grossRent.toLocaleString()}</td>
                  <td className="px-3 py-2 text-right text-emerald-400">${proj.noi.toLocaleString()}</td>
                  <td className="px-3 py-2 text-right text-dark-400">${proj.mortgage.toLocaleString()}</td>
                  <td className={clsx(
                    'px-3 py-2 text-right font-medium',
                    proj.cashFlow > 0 ? 'text-emerald-400' : 'text-red-400'
                  )}>
                    ${proj.cashFlow.toLocaleString()}
                  </td>
                  <td className="px-3 py-2 text-right text-blue-400">${proj.equityBuild.toLocaleString()}</td>
                  <td className="px-3 py-2 text-right text-primary-400">${proj.totalReturn.toLocaleString()}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}


[FILE_END: src\components\FinancialProjections.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\MarketAnalysis.tsx
TYPE: TSX
SIZE: 8543 bytes
================================================================================
'use client';

import { useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface MarketAnalysisProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
}

interface MarketMetrics {
  city: string;
  count: number;
  avgPrice: number;
  avgPricePerSqft: number;
  avgCapRate: number;
  avgEquityGap: number;
  avgRent: number;
}

export default function MarketAnalysis({ properties, onPropertyClick }: MarketAnalysisProps) {
  // Calculate metrics by city
  const marketMetrics = useMemo((): MarketMetrics[] => {
    const byCity: Record<string, PropertyWithCalculations[]> = {};
    
    properties.forEach(p => {
      if (!byCity[p.city]) byCity[p.city] = [];
      byCity[p.city].push(p);
    });

    return Object.entries(byCity).map(([city, props]) => ({
      city,
      count: props.length,
      avgPrice: props.reduce((sum, p) => sum + p.listPrice, 0) / props.length,
      avgPricePerSqft: props.reduce((sum, p) => sum + p.pricePerSqft, 0) / props.length,
      avgCapRate: props.reduce((sum, p) => sum + p.capRate, 0) / props.length,
      avgEquityGap: props.reduce((sum, p) => sum + p.equityGap, 0) / props.length,
      avgRent: props.reduce((sum, p) => sum + p.estimatedRent, 0) / props.length,
    })).sort((a, b) => b.count - a.count);
  }, [properties]);

  // Overall market stats
  const overallStats = useMemo(() => {
    return {
      totalProperties: properties.length,
      avgPrice: properties.reduce((sum, p) => sum + p.listPrice, 0) / properties.length,
      avgPricePerSqft: properties.reduce((sum, p) => sum + p.pricePerSqft, 0) / properties.length,
      avgCapRate: properties.reduce((sum, p) => sum + p.capRate, 0) / properties.length,
      avgEquityGap: properties.reduce((sum, p) => sum + p.equityGap, 0) / properties.length,
      totalEquity: properties.reduce((sum, p) => sum + p.equityGap, 0),
      cities: new Set(properties.map(p => p.city)).size,
    };
  }, [properties]);

  // Price distribution buckets
  const priceDistribution = useMemo(() => {
    const buckets = [
      { label: 'Under $100K', min: 0, max: 100000, count: 0 },
      { label: '$100K-$200K', min: 100000, max: 200000, count: 0 },
      { label: '$200K-$350K', min: 200000, max: 350000, count: 0 },
      { label: '$350K-$500K', min: 350000, max: 500000, count: 0 },
      { label: '$500K+', min: 500000, max: Infinity, count: 0 },
    ];

    properties.forEach(p => {
      const bucket = buckets.find(b => p.listPrice >= b.min && p.listPrice < b.max);
      if (bucket) bucket.count++;
    });

    return buckets;
  }, [properties]);

  // Strategy distribution
  const strategyDistribution = useMemo(() => {
    const dist: Record<string, number> = {};
    properties.forEach(p => {
      dist[p.strategy] = (dist[p.strategy] || 0) + 1;
    });
    return Object.entries(dist).sort((a, b) => b[1] - a[1]);
  }, [properties]);

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="p-4 border-b border-dark-700">
        <h2 className="text-lg font-bold text-white">Market Analysis Dashboard</h2>
        <p className="text-sm text-dark-400">Real estate market insights by location</p>
      </div>

      <div className="flex-1 overflow-auto p-4">
        {/* Overall Stats */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase">Total Properties</p>
            <p className="text-xl font-bold text-white">{overallStats.totalProperties}</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase">Avg Price</p>
            <p className="text-xl font-bold text-white">${Math.round(overallStats.avgPrice).toLocaleString()}</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase">Avg Cap Rate</p>
            <p className="text-xl font-bold text-emerald-400">{overallStats.avgCapRate.toFixed(2)}%</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase">Total Equity</p>
            <p className="text-xl font-bold text-amber-400">${overallStats.totalEquity.toLocaleString()}</p>
          </div>
        </div>

        {/* City Breakdown */}
        <div className="mb-6">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Market by City ({overallStats.cities} cities)
          </h3>
          <div className="bg-dark-800 rounded-lg overflow-hidden">
            <table className="w-full">
              <thead className="bg-dark-700">
                <tr>
                  <th className="px-4 py-2 text-left text-xs font-semibold text-dark-400">City</th>
                  <th className="px-4 py-2 text-right text-xs font-semibold text-dark-400">Properties</th>
                  <th className="px-4 py-2 text-right text-xs font-semibold text-dark-400">Avg Price</th>
                  <th className="px-4 py-2 text-right text-xs font-semibold text-dark-400">$/SqFt</th>
                  <th className="px-4 py-2 text-right text-xs font-semibold text-dark-400">Cap Rate</th>
                  <th className="px-4 py-2 text-right text-xs font-semibold text-dark-400">Avg Rent</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-dark-700">
                {marketMetrics.map((metric) => (
                  <tr 
                    key={metric.city} 
                    className="hover:bg-dark-700 cursor-pointer"
                    onClick={() => {
                      const prop = properties.find(p => p.city === metric.city);
                      if (prop) onPropertyClick?.(prop);
                    }}
                  >
                    <td className="px-4 py-3 text-white font-medium">{metric.city}</td>
                    <td className="px-4 py-3 text-right text-white">{metric.count}</td>
                    <td className="px-4 py-3 text-right text-white">${Math.round(metric.avgPrice).toLocaleString()}</td>
                    <td className="px-4 py-3 text-right text-white">${metric.avgPricePerSqft.toFixed(2)}</td>
                    <td className="px-4 py-3 text-right text-emerald-400">{metric.avgCapRate.toFixed(2)}%</td>
                    <td className="px-4 py-3 text-right text-white">${Math.round(metric.avgRent).toLocaleString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>

        {/* Price Distribution */}
        <div className="mb-6">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Price Distribution
          </h3>
          <div className="space-y-2">
            {priceDistribution.map((bucket) => (
              <div key={bucket.label} className="flex items-center gap-3">
                <span className="w-28 text-sm text-dark-400">{bucket.label}</span>
                <div className="flex-1 h-4 bg-dark-800 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-primary-500 rounded-full"
                    style={{ width: `${(bucket.count / properties.length) * 100}%` }}
                  />
                </div>
                <span className="w-12 text-sm text-white text-right">{bucket.count}</span>
              </div>
            ))}
          </div>
        </div>

        {/* Strategy Distribution */}
        <div>
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Strategy Distribution
          </h3>
          <div className="flex flex-wrap gap-2">
            {strategyDistribution.map(([strategy, count]) => (
              <div 
                key={strategy}
                className="bg-dark-800 rounded-lg px-4 py-2 flex items-center gap-3"
              >
                <span className="text-white font-medium">{strategy}</span>
                <span className="bg-dark-700 px-2 py-0.5 rounded text-sm text-dark-400">
                  {count} ({((count / properties.length) * 100).toFixed(0)}%)
                </span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}


[FILE_END: src\components\MarketAnalysis.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\MobilePWA.tsx
TYPE: TSX
SIZE: 8826 bytes
================================================================================
'use client';

import { useState, useEffect } from 'react';
import clsx from 'clsx';

interface MobilePWAProps {
  // This component shows PWA capabilities and mobile optimizations
}

export default function MobilePWA({}: MobilePWAProps) {
  const [isMobile, setIsMobile] = useState(false);
  const [isPWA, setIsPWA] = useState(false);
  const [orientation, setOrientation] = useState<'portrait' | 'landscape'>('portrait');

  useEffect(() => {
    // Check if mobile
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768 || 'ontouchstart' in window);
    };
    
    // Check if running as PWA
    const checkPWA = () => {
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
      const isInWebAppiOS = (window.navigator as any).standalone === true;
      setIsPWA(isStandalone || isInWebAppiOS);
    };

    // Check orientation
    const checkOrientation = () => {
      setOrientation(window.innerWidth > window.innerHeight ? 'landscape' : 'portrait');
    };

    checkMobile();
    checkPWA();
    checkOrientation();

    window.addEventListener('resize', checkMobile);
    window.addEventListener('resize', checkOrientation);
    window.matchMedia('(display-mode: standalone)').addEventListener('change', checkPWA);

    return () => {
      window.removeEventListener('resize', checkMobile);
      window.removeEventListener('resize', checkOrientation);
    };
  }, []);

  const pwaFeatures = [
    {
      icon: '📱',
      title: 'Installable App',
      description: 'Add to home screen for quick access',
      enabled: true,
    },
    {
      icon: '🔔',
      title: 'Push Notifications',
      description: 'Get alerts for new deals and updates',
      enabled: true,
    },
    {
      icon: '📴',
      title: 'Offline Mode',
      description: 'Access cached properties without internet',
      enabled: false,
    },
    {
      icon: '⚡',
      title: 'Fast Loading',
      description: 'Optimized for mobile networks',
      enabled: true,
    },
    {
      icon: '🔒',
      title: 'Secure Access',
      description: 'Biometric authentication support',
      enabled: false,
    },
    {
      icon: '📊',
      title: 'Mobile Dashboard',
      description: 'Touch-optimized property cards',
      enabled: true,
    },
  ];

  const responsiveFeatures = [
    { name: 'Viewport', value: isMobile ? 'Mobile (<768px)' : 'Desktop (≥768px)', active: true },
    { name: 'Orientation', value: orientation, active: true },
    { name: 'Touch Support', value: 'ontouchstart' in window ? 'Yes' : 'No', active: true },
    { name: 'PWA Mode', value: isPWA ? 'Installed' : 'Browser', active: isPWA },
  ];

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="p-4 border-b border-dark-700">
        <h2 className="text-lg font-bold text-white">Mobile & PWA</h2>
        <p className="text-sm text-dark-400">Mobile optimizations and progressive web app features</p>
      </div>

      <div className="flex-1 overflow-auto p-4">
        {/* Device Status */}
        <div className="bg-dark-800 rounded-lg p-4 mb-6">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Device Status
          </h3>
          <div className="grid grid-cols-2 gap-3">
            {responsiveFeatures.map((feature) => (
              <div 
                key={feature.name}
                className="bg-dark-700 rounded-lg p-3"
              >
                <div className="flex items-center justify-between">
                  <span className="text-sm text-dark-400">{feature.name}</span>
                  <span className={clsx(
                    'text-xs px-2 py-0.5 rounded',
                    feature.active ? 'bg-emerald-900/30 text-emerald-400' : 'bg-dark-600 text-dark-500'
                  )}>
                    {feature.value}
                  </span>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* PWA Features */}
        <div className="mb-6">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            PWA Features
          </h3>
          <div className="space-y-2">
            {pwaFeatures.map((feature) => (
              <div 
                key={feature.title}
                className="bg-dark-800 rounded-lg p-4 flex items-center gap-4"
              >
                <div className="text-2xl">{feature.icon}</div>
                <div className="flex-1">
                  <div className="flex items-center justify-between">
                    <p className="font-medium text-white">{feature.title}</p>
                    <span className={clsx(
                      'text-xs px-2 py-0.5 rounded',
                      feature.enabled ? 'bg-emerald-900/30 text-emerald-400' : 'bg-dark-700 text-dark-500'
                    )}>
                      {feature.enabled ? 'Enabled' : 'Coming Soon'}
                    </span>
                  </div>
                  <p className="text-sm text-dark-400">{feature.description}</p>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Installation Guide */}
        {!isPWA && (
          <div className="bg-dark-800 rounded-lg p-4">
            <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
              Install as App
            </h3>
            <div className="space-y-3">
              <div className="flex items-start gap-3">
                <div className="w-6 h-6 rounded-full bg-primary-500 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">
                  1
                </div>
                <div>
                  <p className="text-white text-sm">iOS (Safari)</p>
                  <p className="text-dark-400 text-xs">Tap the Share button → Add to Home Screen</p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <div className="w-6 h-6 rounded-full bg-primary-500 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">
                  2
                </div>
                <div>
                  <p className="text-white text-sm">Android (Chrome)</p>
                  <p className="text-dark-400 text-xs">Tap the menu (⋮) → Install App</p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <div className="w-6 h-6 rounded-full bg-primary-500 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">
                  3
                </div>
                <div>
                  <p className="text-white text-sm">Desktop (Chrome)</p>
                  <p className="text-dark-400 text-xs">Click the install icon in the address bar</p>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Mobile Tips */}
        <div className="mt-6 bg-dark-800 rounded-lg p-4">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Mobile Tips
          </h3>
          <ul className="space-y-2 text-sm text-dark-400">
            <li className="flex items-start gap-2">
              <span className="text-primary-400">•</span>
              Swipe left/right on property cards to browse quickly
            </li>
            <li className="flex items-start gap-2">
              <span className="text-primary-400">•</span>
              Pinch to zoom on maps and scatter plots
            </li>
            <li className="flex items-start gap-2">
              <span className="text-primary-400">•</span>
              Double-tap to select properties in table view
            </li>
            <li className="flex items-start gap-2">
              <span className="text-primary-400">•</span>
              Pull down to refresh property data
            </li>
            <li className="flex items-start gap-2">
              <span className="text-primary-400">•</span>
              Use landscape mode for full dashboard views
            </li>
          </ul>
        </div>
      </div>

      {/* Bottom Actions */}
      <div className="p-4 border-t border-dark-700">
        <button
          className="w-full py-3 bg-primary-500 text-white rounded-lg font-medium hover:bg-primary-600 transition-colors"
          onClick={() => {
            // In a real app, this would trigger the PWA install prompt
            alert('PWA install prompt would appear here');
          }}
        >
          {isPWA ? 'App Installed ✓' : 'Install App'}
        </button>
      </div>
    </div>
  );
}


[FILE_END: src\components\MobilePWA.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\OpportunityMap.tsx
TYPE: TSX
SIZE: 10966 bytes
================================================================================
'use client';

import { useEffect, useState, useRef } from 'react';
import { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';
import MarkerClusterGroup from 'react-leaflet-cluster';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import 'leaflet.markercluster/dist/MarkerCluster.css';
import 'leaflet.markercluster/dist/MarkerCluster.Default.css';
import { getDecisionColor, Decision } from '@/data/properties';
import { PropertyWithCalculations } from '@/lib/calculations';

// Fix for default marker icons in Next.js
const createMarkerIcon = (color: string) => {
  return L.divIcon({
    className: 'custom-marker',
    html: `
      <div style="
        width: 24px;
        height: 24px;
        background-color: ${color};
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
      ">
        <div style="
          width: 8px;
          height: 8px;
          background-color: white;
          border-radius: 50%;
        "></div>
      </div>
    `,
    iconSize: [24, 24],
    iconAnchor: [12, 12],
    popupAnchor: [0, -12],
  });
};

// Custom cluster icon creator
const createClusterIcon = (cluster: unknown) => {
  const clusterObj = cluster as { getChildCount: () => number; getAllChildMarkers: () => Array<{ options: { title?: string } }> };
  const count = clusterObj.getChildCount();
  const markers = clusterObj.getAllChildMarkers();
  
  // Calculate dominant decision color for cluster
  const decisionCounts: Record<string, number> = {};
  markers.forEach((marker) => {
    const decision = marker.options.title || 'unknown';
    decisionCounts[decision] = (decisionCounts[decision] || 0) + 1;
  });
  
  let dominantColor = '#64748b';
  let maxCount = 0;
  Object.entries(decisionCounts).forEach(([decision, cnt]) => {
    if (cnt > maxCount) {
      maxCount = cnt;
      dominantColor = getDecisionColor(decision as Decision);
    }
  });
  
  // Size based on count
  let size = 40;
  if (count >= 10) size = 50;
  if (count >= 20) size = 60;
  
  return L.divIcon({
    html: `
      <div style="
        width: ${size}px;
        height: ${size}px;
        background-color: ${dominantColor};
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: ${size >= 50 ? '14px' : '12px'};
      ">
        ${count}
      </div>
    `,
    className: 'custom-cluster-icon',
    iconSize: [size, size],
    iconAnchor: [size / 2, size / 2],
  });
};

// Component to fit bounds to markers
function FitBounds({ properties }: { properties: PropertyWithCalculations[] }) {
  const map = useMap();
  
  useEffect(() => {
    if (properties.length > 0) {
      const bounds = L.latLngBounds(properties.map(p => [p.lat, p.lng]));
      map.fitBounds(bounds, { padding: [50, 50] });
    }
  }, [properties, map]);
  
  return null;
}

interface OpportunityMapProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
}

export default function OpportunityMap({ properties, onPropertyClick }: OpportunityMapProps) {
  const [isMounted, setIsMounted] = useState(false);
  const [selectedDecision, setSelectedDecision] = useState<Decision | 'all'>('all');
  const [mapKey, setMapKey] = useState(0);
  const mapContainerRef = useRef<HTMLDivElement>(null);
  const isInitialized = useRef(false);

  useEffect(() => {
    // Prevent double initialization in React StrictMode
    if (isInitialized.current) return;
    isInitialized.current = true;
    
    // Clean up any existing map containers with the same ID
    if (mapContainerRef.current) {
      const container = mapContainerRef.current.querySelector('.leaflet-container');
      if (container && (container as any)._leaflet_id) {
        (container as any)._leaflet_id = undefined;
      }
    }
    
    // Use timestamp as unique key
    setMapKey(Date.now());
    setIsMounted(true);
    
    return () => {
      // Cleanup on unmount
      isInitialized.current = false;
      setIsMounted(false);
    };
  }, []);

  if (!isMounted) {
    return (
      <div className="w-full h-full flex items-center justify-center bg-dark-800 rounded-lg">
        <div className="animate-pulse text-dark-400">Loading map...</div>
      </div>
    );
  }

  const filteredProperties = selectedDecision === 'all' 
    ? properties 
    : properties.filter(p => p.decision === selectedDecision);

  const defaultCenter: [number, number] = [32.5, -94.8];
  const defaultZoom = 9;

  const decisionFilters: { value: Decision | 'all'; label: string; color: string }[] = [
    { value: 'all', label: 'All', color: '#64748b' },
    { value: 'Pass Platinum', label: 'Platinum', color: '#10b981' },
    { value: 'Pass Gold', label: 'Gold', color: '#f59e0b' },
    { value: 'Pass Silver', label: 'Silver', color: '#f97316' },
    { value: 'Hard Fail', label: 'Hard Fail', color: '#ef4444' },
    { value: 'Caution', label: 'Caution', color: '#8b5cf6' },
  ];

  return (
    <div className="relative w-full h-full">
      {/* Filter Controls */}
      <div className="absolute top-4 right-4 z-[1000] bg-dark-800/95 backdrop-blur-sm rounded-lg p-3 border border-dark-600">
        <div className="text-xs font-semibold text-dark-300 mb-2">Filter by Decision</div>
        <div className="flex flex-wrap gap-2">
          {decisionFilters.map((filter) => (
            <button
              key={filter.value}
              onClick={() => setSelectedDecision(filter.value)}
              className={`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${
                selectedDecision === filter.value
                  ? 'ring-2 ring-offset-2 ring-offset-dark-800'
                  : 'opacity-60 hover:opacity-100'
              }`}
              style={{ 
                backgroundColor: `${filter.color}20`,
                color: filter.color,
                '--tw-ring-color': filter.color,
              } as React.CSSProperties}
            >
              {filter.label}
            </button>
          ))}
        </div>
      </div>

      {/* Legend */}
      <div className="absolute bottom-4 left-4 z-[1000] bg-dark-800/95 backdrop-blur-sm rounded-lg p-3 border border-dark-600">
        <div className="text-xs font-semibold text-dark-300 mb-2">Decision Legend</div>
        <div className="space-y-1.5">
          {decisionFilters.slice(1).map((filter) => (
            <div key={filter.value} className="flex items-center gap-2">
              <div 
                className="w-3 h-3 rounded-full" 
                style={{ backgroundColor: filter.color }}
              />
              <span className="text-xs text-dark-300">{filter.label}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Map Container */}
      <div ref={mapContainerRef} className="w-full h-full">
        <MapContainer
          key={`map-${mapKey}`}
          center={defaultCenter}
          zoom={defaultZoom}
          className="w-full h-full rounded-lg"
          style={{ background: '#1e293b' }}
        >
        <TileLayer
          attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
        />
        <FitBounds properties={filteredProperties} />
        
        <MarkerClusterGroup
          iconCreateFunction={createClusterIcon}
          maxClusterRadius={50}
          spiderfyOnMaxZoom={true}
          showCoverageOnHover={false}
          zoomToBoundsOnClick={true}
        >
          {filteredProperties.map((property) => (
            <Marker
              key={property.id}
              position={[property.lat, property.lng]}
              icon={createMarkerIcon(getDecisionColor(property.decision as Decision))}
              title={property.decision}
              eventHandlers={{
                click: () => onPropertyClick?.(property),
              }}
            >
              <Popup>
                <div className="min-w-[200px]">
                  <div className="font-semibold text-white mb-2">{property.address}</div>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between">
                      <span className="text-dark-400">Price:</span>
                      <span className="text-emerald-400 font-medium">
                        ${property.listPrice.toLocaleString()}
                      </span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-dark-400">Decision:</span>
                      <span 
                        className="font-medium"
                        style={{ color: getDecisionColor(property.decision as Decision) }}
                      >
                        {property.decision}
                      </span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-dark-400">Strategy:</span>
                      <span className="text-primary-400">{property.strategy}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-dark-400">Equity Gap:</span>
                      <span className="text-amber-400">
                        ${property.equityGap.toLocaleString()}
                      </span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-dark-400">SqFt:</span>
                      <span>{property.sqft.toLocaleString()}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-dark-400">Beds/Baths:</span>
                      <span>{property.bedrooms} / {property.bathrooms}</span>
                    </div>
                  </div>
                  <div className="mt-3 pt-2 border-t border-dark-600">
                    <div className="text-xs text-dark-400 line-clamp-2">
                      {property.rationale}
                    </div>
                  </div>
                  <a
                     href={property.url ?? '#'}
                     target="_blank"
                     rel="noopener noreferrer"
                     className="mt-3 block text-center text-xs text-primary-400 hover:text-primary-300"
                   >
                     View on Zillow →
                   </a>
                </div>
              </Popup>
            </Marker>
          ))}
        </MarkerClusterGroup>
      </MapContainer>
      </div>
    </div>
  );
}


[FILE_END: src\components\OpportunityMap.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\PortfolioTracker.tsx
TYPE: TSX
SIZE: 10089 bytes
================================================================================
'use client';

import { useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface PortfolioTrackerProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
}

// Owned properties are marked with isOwned = true
export default function PortfolioTracker({ 
  properties, 
  onPropertyClick 
}: PortfolioTrackerProps) {
  // Filter to show only owned properties (or all for potential portfolio)
  const ownedProperties = useMemo(() => {
    return properties.filter(p => (p as any).isOwned === true);
  }, [properties]);

  const prospectProperties = useMemo(() => {
    return properties.filter(p => (p as any).isOwned !== true);
  }, [properties]);

  // Calculate portfolio metrics
  const portfolioMetrics = useMemo(() => {
    const totalInvested = ownedProperties.reduce((sum, p) => sum + ((p as any).purchasePrice || p.listPrice), 0);
    const totalEquityGap = ownedProperties.reduce((sum, p) => sum + p.equityGap, 0);
    const totalMonthlyRent = ownedProperties.reduce((sum, p) => sum + p.estimatedRent, 0);
    const totalValue = ownedProperties.reduce((sum, p) => sum + p.afterRepairValue || p.listPrice, 0);
    const totalCapRate = ownedProperties.length > 0 
      ? ownedProperties.reduce((sum, p) => sum + p.capRate, 0) / ownedProperties.length 
      : 0;
    
    return {
      totalProperties: ownedProperties.length,
      totalInvested,
      totalEquityGap,
      totalMonthlyRent,
      totalValue,
      totalCapRate,
      monthlyCashFlow: totalMonthlyRent - (totalMonthlyRent * 0.05), // Assume 5% vacancy
      annualCashFlow: (totalMonthlyRent - (totalMonthlyRent * 0.05)) * 12,
    };
  }, [ownedProperties]);

  // Calculate potential deal metrics
  const potentialMetrics = useMemo(() => {
    const avgCapRate = prospectProperties.length > 0
      ? prospectProperties.reduce((sum, p) => sum + p.capRate, 0) / prospectProperties.length
      : 0;
    const avgEquityGap = prospectProperties.length > 0
      ? prospectProperties.reduce((sum, p) => sum + p.equityGap, 0) / prospectProperties.length
      : 0;
    const totalEquityGap = prospectProperties.reduce((sum, p) => sum + p.equityGap, 0);
    
    return {
      count: prospectProperties.length,
      avgCapRate,
      avgEquityGap,
      totalEquityGap,
    };
  }, [prospectProperties]);

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header Stats */}
      <div className="p-4 border-b border-dark-700">
        <h2 className="text-lg font-bold text-white mb-4">Investment Portfolio</h2>
        
        {/* Summary Cards */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase tracking-wider">Portfolio Value</p>
            <p className="text-xl font-bold text-white">${portfolioMetrics.totalValue.toLocaleString()}</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase tracking-wider">Total Invested</p>
            <p className="text-xl font-bold text-emerald-400">${portfolioMetrics.totalInvested.toLocaleString()}</p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase tracking-wider">Monthly Cash Flow</p>
            <p className={clsx(
              'text-xl font-bold',
              portfolioMetrics.monthlyCashFlow > 0 ? 'text-emerald-400' : 'text-red-400'
            )}>
              ${portfolioMetrics.monthlyCashFlow.toLocaleString()}
            </p>
          </div>
          <div className="bg-dark-800 rounded-lg p-3">
            <p className="text-xs text-dark-400 uppercase tracking-wider">Avg Cap Rate</p>
            <p className={clsx(
              'text-xl font-bold',
              portfolioMetrics.totalCapRate >= 8 ? 'text-emerald-400' : 
              portfolioMetrics.totalCapRate >= 6 ? 'text-amber-400' : 'text-red-400'
            )}>
              {portfolioMetrics.totalCapRate.toFixed(2)}%
            </p>
          </div>
        </div>
      </div>

      {/* Portfolio Content */}
      <div className="flex-1 overflow-auto p-4">
        {/* Owned Properties */}
        <div className="mb-6">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Owned Properties ({ownedProperties.length})
          </h3>
          
          {ownedProperties.length > 0 ? (
            <div className="space-y-2">
              {ownedProperties.map(property => (
                <div
                  key={property.id}
                  onClick={() => onPropertyClick?.(property)}
                  className="bg-dark-800 rounded-lg p-4 hover:bg-dark-700 cursor-pointer transition-colors"
                >
                  <div className="flex justify-between items-start">
                    <div>
                      <p className="font-medium text-white">{property.address}</p>
                      <p className="text-sm text-dark-400">{property.city}, {property.state}</p>
                    </div>
                    <div className="text-right">
                      <p className="text-emerald-400 font-medium">
                        ${((property as any).purchasePrice || property.listPrice).toLocaleString()}
                      </p>
                      <p className="text-sm text-dark-400">
                        ${property.estimatedRent.toLocaleString()}/mo rent
                      </p>
                    </div>
                  </div>
                  
                  {/* Performance Metrics */}
                  <div className="flex gap-4 mt-3 pt-3 border-t border-dark-700">
                    <div>
                      <p className="text-xs text-dark-500">Cap Rate</p>
                      <p className="text-sm text-white">{property.capRate.toFixed(2)}%</p>
                    </div>
                    <div>
                      <p className="text-xs text-dark-500">Cash-on-Cash</p>
                      <p className="text-sm text-white">{property.cashOnCashReturn.toFixed(2)}%</p>
                    </div>
                    <div>
                      <p className="text-xs text-dark-500">Gross Yield</p>
                      <p className="text-sm text-white">{property.grossYield.toFixed(2)}%</p>
                    </div>
                    <div>
                      <p className="text-xs text-dark-500">Equity</p>
                      <p className="text-sm text-amber-400">${property.equityGap.toLocaleString()}</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="bg-dark-800 rounded-lg p-6 text-center text-dark-400">
              No owned properties yet. Mark properties as owned to track your portfolio.
            </div>
          )}
        </div>

        {/* Potential Deals */}
        <div>
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Potential Deals ({prospectProperties.length})
          </h3>
          
          {/* Summary Stats */}
          <div className="grid grid-cols-3 gap-4 mb-4">
            <div className="bg-dark-800 rounded-lg p-3">
              <p className="text-xs text-dark-400">Avg Cap Rate</p>
              <p className="text-lg font-bold text-white">{potentialMetrics.avgCapRate.toFixed(2)}%</p>
            </div>
            <div className="bg-dark-800 rounded-lg p-3">
              <p className="text-xs text-dark-400">Avg Equity Gap</p>
              <p className="text-lg font-bold text-amber-400">${Math.round(potentialMetrics.avgEquityGap).toLocaleString()}</p>
            </div>
            <div className="bg-dark-800 rounded-lg p-3">
              <p className="text-xs text-dark-400">Total Equity</p>
              <p className="text-lg font-bold text-emerald-400">${potentialMetrics.totalEquityGap.toLocaleString()}</p>
            </div>
          </div>

          {/* Top Prospects */}
          <div className="space-y-2">
            {prospectProperties.slice(0, 5).map(property => (
              <div
                key={property.id}
                onClick={() => onPropertyClick?.(property)}
                className="bg-dark-800 rounded-lg p-3 hover:bg-dark-700 cursor-pointer transition-colors flex justify-between items-center"
              >
                <div>
                  <p className="font-medium text-white text-sm">{property.address}</p>
                  <p className="text-xs text-dark-400">{property.city} • {property.decision}</p>
                </div>
                <div className="text-right">
                  <p className="text-white font-medium">${property.listPrice.toLocaleString()}</p>
                  <p className="text-xs text-amber-400">${property.equityGap.toLocaleString()} equity</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Footer */}
      <div className="p-4 border-t border-dark-700 bg-dark-800/50">
        <div className="flex flex-wrap gap-6 text-sm">
          <div>
            <span className="text-dark-400">Annual Cash Flow: </span>
            <span className={clsx(
              'font-medium',
              portfolioMetrics.annualCashFlow > 0 ? 'text-emerald-400' : 'text-red-400'
            )}>
              ${portfolioMetrics.annualCashFlow.toLocaleString()}
            </span>
          </div>
          <div>
            <span className="text-dark-400">Cash-on-Cash Return: </span>
            <span className="text-white font-medium">
              {portfolioMetrics.totalInvested > 0 
                ? ((portfolioMetrics.annualCashFlow / portfolioMetrics.totalInvested) * 100).toFixed(2)
                : '0.00'}%
            </span>
          </div>
        </div>
      </div>
    </div>
  );
}


[FILE_END: src\components\PortfolioTracker.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\ProjectTimeline.tsx
TYPE: TSX
SIZE: 14661 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface ProjectTimelineProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
}

// Event types for timeline
type EventType = 'purchase' | 'rehab' | 'listing' | 'sale' | 'inspection' | 'closing';

interface TimelineEventData {
  id: string;
  propertyId: string;
  propertyAddress: string;
  title: string;
  eventType: EventType;
  startDate: Date;
  endDate: Date | null;
  isCompleted: boolean;
  assignedTo?: string;
}

// Sample timeline events (in real app, would come from database)
const generateSampleEvents = (properties: PropertyWithCalculations[]): TimelineEventData[] => {
  return properties.slice(0, 5).map((property, index) => {
    const startDate = new Date();
    startDate.setDate(startDate.getDate() + (index * 7));
    
    const endDate = new Date(startDate);
    endDate.setDate(endDate.getDate() + 14);

    return {
      id: `event-${property.id}`,
      propertyId: property.id,
      propertyAddress: property.address,
      title: `${property.strategy} - ${index === 0 ? 'Purchase' : index === 1 ? 'Rehab' : 'Listing'}`,
      eventType: ['purchase', 'rehab', 'listing', 'sale'][index % 4] as EventType,
      startDate,
      endDate,
      isCompleted: index < 2,
    };
  });
};

const EVENT_COLORS: Record<EventType, { bg: string; text: string; border: string }> = {
  purchase: { bg: 'bg-blue-500/20', text: 'text-blue-400', border: 'border-blue-500' },
  rehab: { bg: 'bg-amber-500/20', text: 'text-amber-400', border: 'border-amber-500' },
  listing: { bg: 'bg-purple-500/20', text: 'text-purple-400', border: 'border-purple-500' },
  sale: { bg: 'bg-emerald-500/20', text: 'text-emerald-400', border: 'border-emerald-500' },
  inspection: { bg: 'bg-cyan-500/20', text: 'text-cyan-400', border: 'border-cyan-500' },
  closing: { bg: 'bg-orange-500/20', text: 'text-orange-400', border: 'border-orange-500' },
};

const EVENT_LABELS: Record<EventType, string> = {
  purchase: 'Purchase',
  rehab: 'Rehab',
  listing: 'Listing',
  sale: 'Sale',
  inspection: 'Inspection',
  closing: 'Closing',
};

export default function ProjectTimeline({ properties, onPropertyClick }: ProjectTimelineProps) {
  const [view, setView] = useState<'timeline' | 'gantt'>('timeline');
  const [selectedEvent, setSelectedEvent] = useState<TimelineEventData | null>(null);

  // Generate sample events from properties
  const events = useMemo(() => generateSampleEvents(properties), [properties]);

  // Group events by property
  const eventsByProperty = useMemo(() => {
    const grouped: Record<string, TimelineEventData[]> = {};
    events.forEach(event => {
      if (!grouped[event.propertyId]) {
        grouped[event.propertyId] = [];
      }
      grouped[event.propertyId].push(event);
    });
    return grouped;
  }, [events]);

  // Calculate timeline range
  const timelineRange = useMemo(() => {
    const now = new Date();
    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
    const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 2, 0);
    return { start: startOfMonth, end: endOfMonth };
  }, []);

  // Get position and width for Gantt chart
  const getEventStyle = (event: TimelineEventData) => {
    const totalDays = (timelineRange.end.getTime() - timelineRange.start.getTime()) / (1000 * 60 * 60 * 24);
    const startOffset = (event.startDate.getTime() - timelineRange.start.getTime()) / (1000 * 60 * 60 * 24);
    const duration = event.endDate 
      ? (event.endDate.getTime() - event.startDate.getTime()) / (1000 * 60 * 60 * 24)
      : 7;

    const left = Math.max(0, (startOffset / totalDays) * 100);
    const width = Math.min(100 - left, (duration / totalDays) * 100);

    return {
      left: `${left}%`,
      width: `${Math.max(width, 3)}%`,
    };
  };

  // Render timeline view
  const renderTimelineView = () => (
    <div className="space-y-4">
      {Object.entries(eventsByProperty).map(([propertyId, propertyEvents]) => (
        <div key={propertyId} className="bg-dark-800 rounded-lg p-4">
          <div 
            className="font-medium text-white mb-3 cursor-pointer hover:text-primary-400"
            onClick={() => {
              const prop = properties.find(p => p.id === propertyId);
              if (prop) onPropertyClick?.(prop);
            }}
          >
            {propertyEvents[0].propertyAddress}
          </div>
          <div className="relative">
            {/* Timeline line */}
            <div className="absolute left-2 top-0 bottom-0 w-0.5 bg-dark-600" />
            
            {/* Events */}
            <div className="space-y-3">
              {propertyEvents.map((event, index) => (
                <div key={event.id} className="flex items-start gap-3 ml-1">
                  <div 
                    className={clsx(
                      'w-3 h-3 rounded-full mt-1.5 z-10',
                      EVENT_COLORS[event.eventType].bg,
                      EVENT_COLORS[event.eventType].text,
                      event.isCompleted ? 'opacity-100' : 'opacity-50'
                    )}
                  />
                  <div 
                    className={clsx(
                      'flex-1 p-3 rounded-lg border-l-4 cursor-pointer hover:bg-dark-700 transition-colors',
                      EVENT_COLORS[event.eventType].bg,
                      EVENT_COLORS[event.eventType].border,
                      event.isCompleted ? 'opacity-100' : 'opacity-70'
                    )}
                    onClick={() => setSelectedEvent(event)}
                  >
                    <div className="flex justify-between items-start">
                      <div>
                        <p className="font-medium text-white">{event.title}</p>
                        <p className="text-xs text-dark-400">
                          {EVENT_LABELS[event.eventType]}
                        </p>
                      </div>
                      <div className="text-right">
                        <p className="text-xs text-dark-400">
                          {event.startDate.toLocaleDateString()}
                        </p>
                        {event.isCompleted && (
                          <span className="text-xs text-emerald-400">✓ Done</span>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      ))}
    </div>
  );

  // Render Gantt view
  const renderGanttView = () => {
    const properties_ = Object.keys(eventsByProperty);
    
    return (
      <div className="overflow-x-auto">
        {/* Header with dates */}
        <div className="flex border-b border-dark-700 pb-2 mb-4">
          <div className="w-48 flex-shrink-0" />
          <div className="flex-1 flex">
            {Array.from({ length: 8 }).map((_, weekIndex) => {
              const date = new Date(timelineRange.start);
              date.setDate(date.getDate() + weekIndex * 7);
              return (
                <div key={weekIndex} className="flex-1 text-xs text-dark-500 text-center">
                  {date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                </div>
              );
            })}
          </div>
        </div>

        {/* Gantt rows */}
        <div className="space-y-2">
          {properties_.map((propertyId) => {
            const propertyEvents = eventsByProperty[propertyId];
            return (
              <div key={propertyId} className="flex items-center">
                <div className="w-48 flex-shrink-0 pr-4">
                  <p 
                    className="text-sm text-white truncate cursor-pointer hover:text-primary-400"
                    onClick={() => {
                      const prop = properties.find(p => p.id === propertyId);
                      if (prop) onPropertyClick?.(prop);
                    }}
                  >
                    {propertyEvents[0]?.propertyAddress || 'Unknown'}
                  </p>
                </div>
                <div className="flex-1 relative h-8 bg-dark-800 rounded">
                  {/* Grid lines */}
                  <div className="absolute inset-0 flex">
                    {Array.from({ length: 8 }).map((_, i) => (
                      <div key={i} className="flex-1 border-l border-dark-700" />
                    ))}
                  </div>
                  
                  {/* Events */}
                  {propertyEvents.map((event) => {
                    const style = getEventStyle(event);
                    return (
                      <div
                        key={event.id}
                        className={clsx(
                          'absolute h-6 top-1 rounded text-xs flex items-center px-2 cursor-pointer hover:opacity-80 transition-opacity',
                          EVENT_COLORS[event.eventType].bg,
                          EVENT_COLORS[event.eventType].text,
                          event.isCompleted && 'opacity-100'
                        )}
                        style={style}
                        onClick={() => setSelectedEvent(event)}
                        title={event.title}
                      >
                        <span className="truncate">{event.title}</span>
                      </div>
                    );
                  })}
                </div>
              </div>
            );
          })}
        </div>

        {/* Legend */}
        <div className="flex flex-wrap gap-4 mt-6 pt-4 border-t border-dark-700">
          {Object.entries(EVENT_LABELS).map(([type, label]) => (
            <div key={type} className="flex items-center gap-2">
              <div className={clsx('w-3 h-3 rounded', EVENT_COLORS[type as EventType].bg)} />
              <span className="text-xs text-dark-400">{label}</span>
            </div>
          ))}
        </div>
      </div>
    );
  };

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-dark-700">
        <div>
          <h2 className="text-lg font-bold text-white">Project Timeline</h2>
          <p className="text-sm text-dark-400">Track property investment milestones</p>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={() => setView('timeline')}
            className={clsx(
              'px-3 py-1.5 rounded-lg text-sm font-medium transition-colors',
              view === 'timeline' 
                ? 'bg-primary-500 text-white' 
                : 'bg-dark-700 text-dark-300 hover:bg-dark-600'
            )}
          >
            Timeline
          </button>
          <button
            onClick={() => setView('gantt')}
            className={clsx(
              'px-3 py-1.5 rounded-lg text-sm font-medium transition-colors',
              view === 'gantt' 
                ? 'bg-primary-500 text-white' 
                : 'bg-dark-700 text-dark-300 hover:bg-dark-600'
            )}
          >
            Gantt
          </button>
        </div>
      </div>

      {/* Content */}
      <div className="flex-1 overflow-auto p-4">
        {events.length > 0 ? (
          view === 'timeline' ? renderTimelineView() : renderGanttView()
        ) : (
          <div className="flex items-center justify-center h-full text-dark-400">
            <div className="text-center">
              <p className="text-lg mb-2">No timeline events</p>
              <p className="text-sm">Add properties to see their project timelines</p>
            </div>
          </div>
        )}
      </div>

      {/* Event Detail Modal */}
      {selectedEvent && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-dark-800 rounded-lg p-6 max-w-md w-full">
            <div className="flex justify-between items-start mb-4">
              <h3 className="text-lg font-bold text-white">{selectedEvent.title}</h3>
              <button
                onClick={() => setSelectedEvent(null)}
                className="text-dark-400 hover:text-white"
              >
                ✕
              </button>
            </div>
            
            <div className="space-y-3">
              <div>
                <p className="text-xs text-dark-500 uppercase">Event Type</p>
                <p className={clsx('font-medium', EVENT_COLORS[selectedEvent.eventType].text)}>
                  {EVENT_LABELS[selectedEvent.eventType]}
                </p>
              </div>
              <div>
                <p className="text-xs text-dark-500 uppercase">Property</p>
                <p className="text-white">{selectedEvent.propertyAddress}</p>
              </div>
              <div>
                <p className="text-xs text-dark-500 uppercase">Start Date</p>
                <p className="text-white">{selectedEvent.startDate.toLocaleDateString()}</p>
              </div>
              {selectedEvent.endDate && (
                <div>
                  <p className="text-xs text-dark-500 uppercase">End Date</p>
                  <p className="text-white">{selectedEvent.endDate.toLocaleDateString()}</p>
                </div>
              )}
              <div>
                <p className="text-xs text-dark-500 uppercase">Status</p>
                <p className={selectedEvent.isCompleted ? 'text-emerald-400' : 'text-amber-400'}>
                  {selectedEvent.isCompleted ? 'Completed' : 'In Progress'}
                </p>
              </div>
            </div>

            <div className="flex gap-2 mt-6">
              <button
                className="flex-1 py-2 bg-dark-700 text-white rounded-lg hover:bg-dark-600 transition-colors"
                onClick={() => setSelectedEvent(null)}
              >
                Close
              </button>
              <button
                className="flex-1 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors"
                onClick={() => {
                  const prop = properties.find(p => p.id === selectedEvent.propertyId);
                  if (prop) onPropertyClick?.(prop);
                  setSelectedEvent(null);
                }}
              >
                View Property
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


[FILE_END: src\components\ProjectTimeline.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\PropertyComparator.tsx
TYPE: TSX
SIZE: 11106 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';
import { getDecisionColor, Decision } from '@/data/properties';

interface PropertyComparatorProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
  onClose?: () => void;
}

// Metrics to compare
interface ComparisonMetric {
  key: keyof PropertyWithCalculations;
  label: string;
  format: 'currency' | 'number' | 'percent' | 'boolean' | 'text';
  higherIsBetter?: boolean;
}

const COMPARISON_METRICS: ComparisonMetric[] = [
  { key: 'listPrice', label: 'List Price', format: 'currency', higherIsBetter: false },
  { key: 'sqft', label: 'Square Feet', format: 'number', higherIsBetter: true },
  { key: 'pricePerSqft', label: 'Price/SqFt', format: 'currency', higherIsBetter: false },
  { key: 'bedrooms', label: 'Bedrooms', format: 'number', higherIsBetter: true },
  { key: 'bathrooms', label: 'Bathrooms', format: 'number', higherIsBetter: true },
  { key: 'equityGap', label: 'Equity Gap', format: 'currency', higherIsBetter: true },
  { key: 'capRate', label: 'Cap Rate', format: 'percent', higherIsBetter: true },
  { key: 'cashOnCashReturn', label: 'Cash-on-Cash', format: 'percent', higherIsBetter: true },
  { key: 'mao', label: 'MAO', format: 'currency', higherIsBetter: false },
  { key: 'grossYield', label: 'Gross Yield', format: 'percent', higherIsBetter: true },
  { key: 'onePercentRule', label: '1% Rule', format: 'boolean', higherIsBetter: true },
  { key: 'estimatedRent', label: 'Est. Rent', format: 'currency', higherIsBetter: true },
  { key: 'annualTaxes', label: 'Annual Taxes', format: 'currency', higherIsBetter: false },
  { key: 'renovationBudget', label: 'Renovation Budget', format: 'currency', higherIsBetter: false },
  { key: 'afterRepairValue', label: 'After Repair Value', format: 'currency', higherIsBetter: true },
];

export default function PropertyComparator({ 
  properties, 
  onPropertyClick,
  onClose 
}: PropertyComparatorProps) {
  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
  const [isSelecting, setIsSelecting] = useState(false);

  // Toggle property selection for comparison
  const toggleSelection = (id: string) => {
    setSelectedIds(prev => {
      const newSet = new Set(prev);
      if (newSet.has(id)) {
        newSet.delete(id);
      } else if (newSet.size < 4) {
        // Limit to 4 properties for comparison
        newSet.add(id);
      }
      return newSet;
    });
  };

  // Get selected properties
  const selectedProperties = useMemo(() => {
    return properties.filter(p => selectedIds.has(p.id));
  }, [properties, selectedIds]);

  // Format value based on metric type
  const formatValue = (metric: ComparisonMetric, value: any): string => {
    if (value === null || value === undefined) return '-';
    
    switch (metric.format) {
      case 'currency':
        return `$${Number(value).toLocaleString()}`;
      case 'number':
        return Number(value).toLocaleString();
      case 'percent':
        return `${Number(value).toFixed(2)}%`;
      case 'boolean':
        return value ? '✓' : '✗';
      case 'text':
        return String(value);
      default:
        return String(value);
    }
  };

  // Determine if a value is the best among selected properties
  const getBestValue = (metric: ComparisonMetric): number | boolean => {
    const values = selectedProperties.map(p => p[metric.key]);
    
    if (metric.format === 'currency' || metric.format === 'number' || metric.format === 'percent') {
      const numericValues = values.map(v => Number(v) || 0);
      return metric.higherIsBetter 
        ? Math.max(...numericValues)
        : Math.min(...numericValues);
    }
    
    if (metric.format === 'boolean') {
      return values.some(v => v === true);
    }
    
    return 0;
  };

  // Check if a value is the best
  const isBestValue = (metric: ComparisonMetric, value: any): boolean => {
    const bestValue = getBestValue(metric);
    
    if (metric.format === 'boolean') {
      return value === true && bestValue === true;
    }
    
    const numericValue = Number(value) || 0;
    const numericBest = Number(bestValue) || 0;
    
    if (metric.higherIsBetter) {
      return numericValue >= numericBest && numericValue > 0;
    } else {
      return numericValue <= numericBest && numericValue > 0;
    }
  };

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-dark-700">
        <div>
          <h2 className="text-lg font-bold text-white">Property Comparison</h2>
          <p className="text-sm text-dark-400">
            Select up to 4 properties to compare side-by-side
          </p>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={() => setIsSelecting(!isSelecting)}
            className={clsx(
              'px-3 py-1.5 rounded-lg text-sm font-medium transition-colors',
              isSelecting 
                ? 'bg-primary-500 text-white' 
                : 'bg-dark-700 text-dark-300 hover:bg-dark-600'
            )}
          >
            {isSelecting ? 'Done Selecting' : 'Select Properties'}
          </button>
          {onClose && (
            <button
              onClick={onClose}
              className="p-2 text-dark-400 hover:text-white transition-colors"
            >
              ✕
            </button>
          )}
        </div>
      </div>

      {/* Property Selection Grid */}
      {isSelecting && (
        <div className="p-4 border-b border-dark-700">
          <p className="text-sm text-dark-400 mb-2">Click properties to add to comparison:</p>
          <div className="flex flex-wrap gap-2">
            {properties.slice(0, 10).map(property => (
              <button
                key={property.id}
                onClick={() => toggleSelection(property.id)}
                className={clsx(
                  'px-3 py-2 rounded-lg text-sm font-medium transition-all',
                  selectedIds.has(property.id)
                    ? 'bg-primary-500 text-white'
                    : 'bg-dark-700 text-dark-300 hover:bg-dark-600'
                )}
              >
                {property.address.substring(0, 20)}...
                {selectedIds.has(property.id) && ' ✓'}
              </button>
            ))}
          </div>
        </div>
      )}

      {/* Comparison Table */}
      {selectedProperties.length > 0 ? (
        <div className="flex-1 overflow-auto">
          <table className="w-full">
            <thead className="sticky top-0 bg-dark-800">
              <tr>
                <th className="px-4 py-3 text-left text-xs font-semibold text-dark-400 uppercase tracking-wider">
                  Metric
                </th>
                {selectedProperties.map(property => (
                  <th 
                    key={property.id} 
                    className="px-4 py-3 text-left min-w-[180px]"
                  >
                    <div className="flex flex-col">
                      <span className="font-medium text-white text-sm">
                        {property.address.length > 25 
                          ? property.address.substring(0, 25) + '...' 
                          : property.address}
                      </span>
                      <span className="text-xs text-dark-400">{property.city}</span>
                      <span 
                        className="text-xs mt-1 inline-block px-2 py-0.5 rounded"
                        style={{ 
                          backgroundColor: `${getDecisionColor(property.decision as Decision)}20`,
                          color: getDecisionColor(property.decision as Decision)
                        }}
                      >
                        {property.decision}
                      </span>
                    </div>
                  </th>
                ))}
              </tr>
            </thead>
            <tbody className="divide-y divide-dark-700">
              {COMPARISON_METRICS.map(metric => (
                <tr key={metric.key} className="hover:bg-dark-800/50">
                  <td className="px-4 py-3 text-sm font-medium text-dark-300">
                    {metric.label}
                  </td>
                  {selectedProperties.map(property => {
                    const value = property[metric.key];
                    const isBest = isBestValue(metric, value);
                    
                    return (
                      <td 
                        key={property.id} 
                        className={clsx(
                          'px-4 py-3 text-sm',
                          isBest && metric.format !== 'boolean' 
                            ? 'text-emerald-400 font-medium' 
                            : 'text-white'
                        )}
                      >
                        <div className="flex items-center gap-2">
                          {formatValue(metric, value)}
                          {isBest && metric.format !== 'boolean' && (
                            <span className="text-emerald-400 text-xs" title="Best value">★</span>
                          )}
                        </div>
                      </td>
                    );
                  })}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      ) : (
        <div className="flex-1 flex items-center justify-center text-dark-400">
          <div className="text-center">
            <p className="text-lg mb-2">No properties selected</p>
            <p className="text-sm">Click &quot;Select Properties&quot; to choose properties to compare</p>
          </div>
        </div>
      )}

      {/* Quick Stats */}
      {selectedProperties.length > 1 && (
        <div className="p-4 border-t border-dark-700 bg-dark-800/50">
          <div className="flex flex-wrap gap-6 text-sm">
            <div>
              <span className="text-dark-400">Avg Price: </span>
              <span className="text-white font-medium">
                ${Math.round(selectedProperties.reduce((sum, p) => sum + p.listPrice, 0) / selectedProperties.length).toLocaleString()}
              </span>
            </div>
            <div>
              <span className="text-dark-400">Avg Cap Rate: </span>
              <span className="text-emerald-400 font-medium">
                {(selectedProperties.reduce((sum, p) => sum + p.capRate, 0) / selectedProperties.length).toFixed(2)}%
              </span>
            </div>
            <div>
              <span className="text-dark-400">Total Equity Gap: </span>
              <span className="text-amber-400 font-medium">
                ${selectedProperties.reduce((sum, p) => sum + p.equityGap, 0).toLocaleString()}
              </span>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


[FILE_END: src\components\PropertyComparator.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\PropertyDataTable.tsx
TYPE: TSX
SIZE: 16707 bytes
================================================================================
'use client';

import { useMemo, useState } from 'react';
import {
  useReactTable,
  getCoreRowModel,
  getSortedRowModel,
  getFilteredRowModel,
  getPaginationRowModel,
  flexRender,
  createColumnHelper,
  SortingState,
  ColumnFiltersState,
  ColumnDef,
  FilterFn,
  Row,
} from '@tanstack/react-table';
import clsx from 'clsx';
import { 
  getDecisionColor, 
  Decision,
  Strategy,
} from '@/data/properties';
import { PropertyWithCalculations } from '@/lib/calculations';

interface PropertyDataTableProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
  onToggleFavorite?: (id: string) => void;
  getIsFavorite?: (id: string) => boolean;
}

// Typed column helper for PropertyWithCalculations type
const columnHelper = createColumnHelper<PropertyWithCalculations>();

// Type-safe strategy colors
const STRATEGY_COLORS: Record<Strategy, string> = {
  'Retail Flip': '#3b82f6',
  'Section 8': '#22c55e',
  'BRRR': '#a855f7',
  'Owner Finance': '#06b6d4',
  'Wholesaling': '#ec4899',
};

// Type-safe decision filter options
const DECISION_FILTER_OPTIONS: readonly { value: Decision | 'all'; label: string }[] = [
  { value: 'all', label: 'All Decisions' },
  { value: 'Pass Platinum', label: 'Platinum' },
  { value: 'Pass Gold', label: 'Gold' },
  { value: 'Pass Silver', label: 'Silver' },
  { value: 'Hard Fail', label: 'Hard Fail' },
  { value: 'Caution', label: 'Caution' },
] as const;

// Type-safe decision filter function
const decisionFilterFn: FilterFn<PropertyWithCalculations> = (
  row: Row<PropertyWithCalculations>,
  columnId: string,
  filterValue: string
): boolean => {
  if (filterValue === 'all') return true;
  const decision = row.getValue(columnId) as Decision;
  return decision === filterValue;
};

// Interface for one percent rule calculation result
interface OnePercentRuleResult {
  passes: boolean;
  ratio: number;
  rent: number;
}

// Interface for rent state
type RentState = Record<string, number>;

export default function PropertyDataTable({ 
  properties, 
  onPropertyClick,
  onToggleFavorite,
  getIsFavorite,
}: PropertyDataTableProps) {
  const [sorting, setSorting] = useState<SortingState>([]);
  const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([]);
  const [globalFilter, setGlobalFilter] = useState<string>('');
  const [estimatedRent, setEstimatedRent] = useState<RentState>({});

  // Typed columns array
  const columns = useMemo(
    () => [
      // Favorites column
      columnHelper.display({
        id: 'favorite',
        header: '★',
        cell: (info) => {
          const property = info.row.original;
          const isFavorite = getIsFavorite?.(property.id) ?? property.isFavorite;
          return (
            <button
              onClick={(e: React.MouseEvent) => {
                e.stopPropagation();
                onToggleFavorite?.(property.id);
              }}
              className={clsx(
                'text-xl transition-colors hover:scale-110',
                isFavorite ? 'text-amber-400' : 'text-dark-500 hover:text-amber-300'
              )}
              title={isFavorite ? 'Remove from favorites' : 'Add to favorites'}
            >
              {isFavorite ? '★' : '☆'}
            </button>
          );
        },
      }),
      columnHelper.accessor('address', {
        header: 'Address',
        cell: (info) => (
          <div>
            <div className="font-medium text-white">{info.getValue()}</div>
            <div className="text-xs text-dark-400">{info.row.original.city}</div>
          </div>
        ),
        footer: (props) => props.column.id,
      }),
      columnHelper.accessor('listPrice', {
        header: 'List Price',
        cell: (info) => {
          const price = info.getValue();
          return (
            <span className="text-emerald-400 font-medium">
              ${price.toLocaleString()}
            </span>
          );
        },
        footer: (props) => props.column.id,
      }),
      columnHelper.accessor('sqft', {
        header: 'SqFt',
        cell: (info) => {
          const sqft = info.getValue();
          return sqft > 0 ? sqft.toLocaleString() : 'N/A';
        },
        footer: (props) => props.column.id,
      }),
      columnHelper.accessor('pricePerSqft', {
         id: 'pricePerSqft',
         header: '$/SqFt',
         cell: (info) => {
           const value = info.getValue();
           const avgPricePerSqft = properties.length > 0
             ? properties.reduce((sum, p) => sum + p.pricePerSqft, 0) / properties.length
             : 0;
           const isBelowAverage = value < avgPricePerSqft;
           return (
             <span className={clsx(isBelowAverage && 'text-emerald-400 font-medium')}>
               ${value.toFixed(2)}
             </span>
           );
         },
         footer: (props) => props.column.id,
       }),
       columnHelper.accessor('bedrooms', {
         header: 'Beds',
         cell: (info) => info.getValue(),
         footer: (props) => props.column.id,
       }),
       columnHelper.accessor('pricePerDoor', {
         id: 'pricePerDoor',
         header: '$/Door',
         cell: (info) => (
           <span className="text-primary-400">
             ${info.getValue().toLocaleString()}
           </span>
         ),
         footer: (props) => props.column.id,
       }),
      columnHelper.accessor('decision', {
        header: 'Decision',
        cell: (info) => {
          const decision = info.getValue() as Decision;
          const color = getDecisionColor(decision);
          return (
            <span
              className="px-2 py-1 rounded-full text-xs font-semibold"
              style={{
                backgroundColor: `${color}20`,
                color: color,
              }}
            >
              {decision}
            </span>
          );
        },
        footer: (props) => props.column.id,
        filterFn: decisionFilterFn,
      }),
      columnHelper.accessor('strategy', {
        header: 'Strategy',
        cell: (info) => {
          const strategy = info.getValue() as Strategy;
          const color = STRATEGY_COLORS[strategy] || '#6b7280';
          return (
            <span
              className="px-2 py-0.5 rounded text-xs font-medium"
              style={{
                backgroundColor: `${color}20`,
                color: color,
              }}
            >
              {strategy}
            </span>
          );
        },
        footer: (props) => props.column.id,
      }),
      columnHelper.accessor('equityGap', {
        header: 'Equity Gap',
        cell: (info) => {
          const gap = info.getValue();
          return (
            <span className="text-amber-400 font-medium">
              ${gap.toLocaleString()}
            </span>
          );
        },
        footer: (props) => props.column.id,
      }),
      columnHelper.accessor('capRate', {
         id: 'capRate',
         header: 'Cap Rate',
         cell: (info) => {
           const capRate = info.getValue();
           return (
             <span className={clsx(
               'text-sm font-medium',
               capRate >= 8 ? 'text-emerald-400' : 
               capRate >= 6 ? 'text-amber-400' : 'text-red-400'
             )}>
               {capRate.toFixed(2)}%
             </span>
           );
         },
         footer: (props) => props.column.id,
       }),
       columnHelper.accessor('cashOnCashReturn', {
         id: 'cashOnCash',
         header: 'Cash-on-Cash',
         cell: (info) => {
           const coc = info.getValue();
           return (
             <span className={clsx(
               'text-sm font-medium',
               coc >= 15 ? 'text-emerald-400' : 
               coc >= 10 ? 'text-amber-400' : 'text-red-400'
             )}>
               {coc.toFixed(2)}%
             </span>
           );
         },
         footer: (props) => props.column.id,
       }),
       columnHelper.accessor('mao', {
         id: 'mao',
         header: 'MAO',
         cell: (info) => (
           <span className="text-emerald-400 font-medium">
             ${info.getValue().toLocaleString()}
           </span>
         ),
         footer: (props) => props.column.id,
       }),
       columnHelper.accessor('grossYield', {
         id: 'grossYield',
         header: 'Gross Yield',
         cell: (info) => {
           const yield_ = info.getValue();
           return (
             <span className={clsx(
               'text-sm font-medium',
               yield_ >= 12 ? 'text-emerald-400' : 
               yield_ >= 8 ? 'text-amber-400' : 'text-red-400'
             )}>
               {yield_.toFixed(2)}%
             </span>
           );
         },
         footer: (props) => props.column.id,
       }),
       columnHelper.accessor((row: PropertyWithCalculations): OnePercentRuleResult => {
         const rent = estimatedRent[row.id] ?? row.estimatedRent ?? 0;
         const price = row.listPrice;
         if (rent <= 0 || price <= 0) return { passes: false, ratio: 0, rent };
         const ratio = (rent / price) * 100;
         return { passes: ratio >= 1, ratio, rent };
       }, {
        id: 'onePercentRule',
        header: '1% Rule',
        cell: (info) => {
          const { passes, ratio, rent } = info.getValue();
          const propertyId = info.row.original.id;
          
          return (
            <div className="flex flex-col gap-1">
              <input
                type="number"
                placeholder="Est. Rent"
                value={rent || ''}
                onChange={(e: React.ChangeEvent<HTMLInputElement>) => {
                  const value = parseFloat(e.target.value) || 0;
                  setEstimatedRent((prev: RentState) => ({
                    ...prev,
                    [propertyId]: value,
                  }));
                }}
                className="w-20 px-2 py-1 text-xs bg-dark-700 border border-dark-600 rounded focus:outline-none focus:border-primary-500"
                onClick={(e: React.MouseEvent<HTMLInputElement>) => e.stopPropagation()}
              />
              {rent > 0 && (
                <span
                  className={clsx(
                    'text-xs font-medium',
                    passes ? 'text-emerald-400' : 'text-red-400'
                  )}
                >
                  {ratio.toFixed(2)}% {passes ? '✓' : '✗'}
                </span>
              )}
            </div>
          );
        },
        footer: (props) => props.column.id,
      }),
      columnHelper.accessor('rationale', {
        header: 'Rationale',
        cell: (info) => {
          const rationale = info.getValue();
          return (
            <div className="max-w-xs truncate text-xs text-dark-300" title={rationale}>
              {rationale}
            </div>
          );
        },
        footer: (props) => props.column.id,
      }),
    ],
    [properties, estimatedRent]
  );

  const table = useReactTable({
    data: properties,
    columns,
    state: {
      sorting,
      columnFilters,
      globalFilter,
    },
    onSortingChange: setSorting,
    onColumnFiltersChange: setColumnFilters,
    onGlobalFilterChange: setGlobalFilter,
    getCoreRowModel: getCoreRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
  });

  // Get current decision filter value with type safety
  const currentDecisionFilter = (columnFilters.find((f) => f.id === 'decision')?.value as string) || 'all';

  return (
    <div className="w-full h-full flex flex-col">
      {/* Controls */}
      <div className="flex flex-wrap items-center justify-between gap-4 mb-4">
        <div className="flex items-center gap-4">
          {/* Global Search */}
          <div className="relative">
            <input
              type="text"
              placeholder="Search all columns..."
              value={globalFilter as string}
              onChange={(e) => setGlobalFilter(e.target.value)}
              className="w-64 px-4 py-2 bg-dark-800 border border-dark-600 rounded-lg text-sm focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500"
            />
          </div>

          {/* Decision Filter */}
          <select
            value={currentDecisionFilter}
            onChange={(e) => {
              const value = e.target.value;
              table.getColumn('decision')?.setFilterValue(value);
            }}
            className="px-4 py-2 bg-dark-800 border border-dark-600 rounded-lg text-sm focus:outline-none focus:border-primary-500"
          >
            {DECISION_FILTER_OPTIONS.map((option) => (
              <option key={option.value} value={option.value}>
                {option.label}
              </option>
            ))}
          </select>
        </div>

        {/* Pagination Controls */}
        <div className="flex items-center gap-2">
          <button
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
            className="px-3 py-1.5 bg-dark-700 border border-dark-600 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-dark-600 transition-colors"
          >
            Previous
          </button>
          <span className="text-sm text-dark-300">
            Page {table.getState().pagination.pageIndex + 1} of {table.getPageCount()}
          </span>
          <button
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
            className="px-3 py-1.5 bg-dark-700 border border-dark-600 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-dark-600 transition-colors"
          >
            Next
          </button>
        </div>
      </div>

      {/* Table */}
      <div className="flex-1 overflow-auto bg-dark-800 rounded-lg border border-dark-700">
        <table className="w-full">
          <thead className="bg-dark-900 sticky top-0">
            {table.getHeaderGroups().map((headerGroup) => (
              <tr key={headerGroup.id}>
                {headerGroup.headers.map((header) => (
                  <th
                    key={header.id}
                    className={clsx(
                      'px-4 py-3 text-left text-xs font-semibold text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-dark-700 transition-colors',
                      header.column.getIsSorted() && 'text-primary-400'
                    )}
                    onClick={header.column.getToggleSortingHandler()}
                  >
                    <div className="flex items-center gap-2">
                      {flexRender(
                        header.column.columnDef.header,
                        header.getContext()
                      )}
                      {header.column.getIsSorted() && (
                        <span>
                          {header.column.getIsSorted() === 'asc' ? '↑' : '↓'}
                        </span>
                      )}
                    </div>
                  </th>
                ))}
              </tr>
            ))}
          </thead>
          <tbody className="divide-y divide-dark-700">
            {table.getRowModel().rows.map((row) => (
              <tr
                key={row.id}
                onClick={() => onPropertyClick?.(row.original)}
                className="hover:bg-dark-700/50 cursor-pointer transition-colors"
              >
                {row.getVisibleCells().map((cell) => (
                  <td key={cell.id} className="px-4 py-3 text-sm">
                    {flexRender(cell.column.columnDef.cell, cell.getContext())}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>

        {/* Empty State */}
        {table.getRowModel().rows.length === 0 && (
          <div className="text-center py-12 text-dark-400">
            No properties found matching your criteria
          </div>
        )}
      </div>

      {/* Footer Stats */}
      <div className="mt-4 flex items-center justify-between text-sm text-dark-400">
        <div>
          Showing {table.getRowModel().rows.length} of {properties.length} properties
        </div>
        <div className="flex items-center gap-4">
          <span>
            Total Equity Gap:{' '}
            <span className="text-amber-400 font-medium">
              ${properties.reduce((sum, p) => sum + p.equityGap, 0).toLocaleString()}
            </span>
          </span>
        </div>
      </div>
    </div>
  );
}

[FILE_END: src\components\PropertyDataTable.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\Providers.tsx
TYPE: TSX
SIZE: 306 bytes
================================================================================
'use client';

import { ReactNode } from 'react';
import { PropertyProvider } from '@/context/PropertyContext';

interface ProvidersProps {
  children: ReactNode;
}

export function Providers({ children }: ProvidersProps) {
  return (
    <PropertyProvider>
      {children}
    </PropertyProvider>
  );
}


[FILE_END: src\components\Providers.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\RehabEstimator.tsx
TYPE: TSX
SIZE: 15199 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface RehabEstimatorProps {
  property: PropertyWithCalculations | null;
  onClose?: () => void;
}

// Rehab categories with typical cost ranges
interface RehabCategory {
  name: string;
  icon: string;
  items: RehabItemTemplate[];
}

interface RehabItemTemplate {
  name: string;
  unit: string;
  lowCost: number;
  highCost: number;
  avgCost: number;
}

const REHAB_CATEGORIES: RehabCategory[] = [
  {
    name: 'Kitchen',
    icon: '🍳',
    items: [
      { name: 'Cabinet Refinish', unit: 'linear ft', lowCost: 30, highCost: 60, avgCost: 45 },
      { name: 'New Cabinets', unit: 'linear ft', lowCost: 150, highCost: 400, avgCost: 275 },
      { name: 'Countertop (Laminate)', unit: 'sq ft', lowCost: 20, highCost: 40, avgCost: 30 },
      { name: 'Countertop (Granite)', unit: 'sq ft', lowCost: 50, highCost: 100, avgCost: 75 },
      { name: 'Appliances', unit: 'unit', lowCost: 500, highCost: 2000, avgCost: 1200 },
      { name: 'Sink & Faucet', unit: 'unit', lowCost: 200, highCost: 600, avgCost: 400 },
      { name: 'Flooring', unit: 'sq ft', lowCost: 3, highCost: 10, avgCost: 6 },
    ],
  },
  {
    name: 'Bathroom',
    icon: '🚿',
    items: [
      { name: 'Full Bath Remodel', unit: 'unit', lowCost: 3000, highCost: 10000, avgCost: 6500 },
      { name: 'Shower/Tub', unit: 'unit', lowCost: 800, highCost: 3000, avgCost: 1900 },
      { name: 'Vanity & Sink', unit: 'unit', lowCost: 400, highCost: 1500, avgCost: 950 },
      { name: 'Toilet', unit: 'unit', lowCost: 200, highCost: 500, avgCost: 350 },
      { name: 'Tile (Floor)', unit: 'sq ft', lowCost: 5, highCost: 15, avgCost: 10 },
      { name: 'Tile (Shower)', unit: 'sq ft', lowCost: 10, highCost: 25, avgCost: 17 },
    ],
  },
  {
    name: 'Flooring',
    icon: '🏠',
    items: [
      { name: 'Hardwood', unit: 'sq ft', lowCost: 6, highCost: 14, avgCost: 10 },
      { name: 'Laminate', unit: 'sq ft', lowCost: 3, highCost: 8, avgCost: 5 },
      { name: 'Carpet', unit: 'sq ft', lowCost: 2, highCost: 6, avgCost: 4 },
      { name: 'Tile', unit: 'sq ft', lowCost: 5, highCost: 15, avgCost: 10 },
      { name: 'Vinyl Plank', unit: 'sq ft', lowCost: 3, highCost: 8, avgCost: 5 },
    ],
  },
  {
    name: 'HVAC',
    icon: '❄️',
    items: [
      { name: 'AC Unit', unit: 'unit', lowCost: 2000, highCost: 5000, avgCost: 3500 },
      { name: 'Furnace', unit: 'unit', lowCost: 2000, highCost: 5000, avgCost: 3500 },
      { name: 'Ductwork', unit: 'linear ft', lowCost: 10, highCost: 25, avgCost: 17 },
      { name: 'Thermostat', unit: 'unit', lowCost: 100, highCost: 300, avgCost: 200 },
      { name: 'Vent Cleaning', unit: 'unit', lowCost: 200, highCost: 500, avgCost: 350 },
    ],
  },
  {
    name: 'Electrical',
    icon: '⚡',
    items: [
      { name: 'Panel Upgrade', unit: 'unit', lowCost: 1500, highCost: 4000, avgCost: 2750 },
      { name: 'Outlets/Switches', unit: 'unit', lowCost: 100, highCost: 200, avgCost: 150 },
      { name: 'Lighting', unit: 'unit', lowCost: 50, highCost: 200, avgCost: 125 },
      { name: 'Ceiling Fan', unit: 'unit', lowCost: 150, highCost: 400, avgCost: 275 },
      { name: 'GFCI Installation', unit: 'unit', lowCost: 100, highCost: 200, avgCost: 150 },
    ],
  },
  {
    name: 'Plumbing',
    icon: '🔧',
    items: [
      { name: 'Water Heater', unit: 'unit', lowCost: 800, highCost: 2000, avgCost: 1400 },
      { name: 'Repipe', unit: 'linear ft', lowCost: 3, highCost: 8, avgCost: 5 },
      { name: 'Fixtures', unit: 'unit', lowCost: 100, highCost: 400, avgCost: 250 },
      { name: 'Sump Pump', unit: 'unit', lowCost: 500, highCost: 1500, avgCost: 1000 },
    ],
  },
  {
    name: 'Exterior',
    icon: '🏡',
    items: [
      { name: 'Siding', unit: 'sq ft', lowCost: 4, highCost: 12, avgCost: 8 },
      { name: 'Roofing', unit: 'sq ft', lowCost: 5, highCost: 15, avgCost: 10 },
      { name: 'Paint (Exterior)', unit: 'sq ft', lowCost: 2, highCost: 5, avgCost: 3 },
      { name: 'Landscaping', unit: 'lot', lowCost: 1000, highCost: 5000, avgCost: 3000 },
      { name: 'Driveway', unit: 'sq ft', lowCost: 3, highCost: 8, avgCost: 5 },
      { name: 'Fencing', unit: 'linear ft', lowCost: 20, highCost: 50, avgCost: 35 },
    ],
  },
  {
    name: 'Windows & Doors',
    icon: '🪟',
    items: [
      { name: 'Window Replacement', unit: 'unit', lowCost: 300, highCost: 800, avgCost: 550 },
      { name: 'Entry Door', unit: 'unit', lowCost: 300, highCost: 1000, avgCost: 650 },
      { name: 'Interior Doors', unit: 'unit', lowCost: 150, highCost: 400, avgCost: 275 },
      { name: 'Garage Door', unit: 'unit', lowCost: 500, highCost: 1500, avgCost: 1000 },
    ],
  },
  {
    name: 'Finishing',
    icon: '🎨',
    items: [
      { name: 'Interior Paint', unit: 'sq ft', lowCost: 1, highCost: 3, avgCost: 2 },
      { name: 'Drywall Repair', unit: 'sq ft', lowCost: 2, highCost: 5, avgCost: 3 },
      { name: 'Trim & Molding', unit: 'linear ft', lowCost: 3, highCost: 10, avgCost: 6 },
      { name: 'Closet Systems', unit: 'unit', lowCost: 500, highCost: 2000, avgCost: 1250 },
    ],
  },
];

interface SelectedItem {
  categoryIndex: number;
  itemIndex: number;
  quantity: number;
}

export default function RehabEstimator({ property, onClose }: RehabEstimatorProps) {
  const [selectedItems, setSelectedItems] = useState<SelectedItem[]>([]);
  const [quality, setQuality] = useState<'low' | 'medium' | 'high'>('medium');

  // Add item to estimate
  const addItem = (categoryIndex: number, itemIndex: number) => {
    setSelectedItems(prev => {
      const existing = prev.find(
        i => i.categoryIndex === categoryIndex && i.itemIndex === itemIndex
      );
      if (existing) {
        return prev.map(i => 
          i.categoryIndex === categoryIndex && i.itemIndex === itemIndex
            ? { ...i, quantity: i.quantity + 1 }
            : i
        );
      }
      return [...prev, { categoryIndex, itemIndex, quantity: 1 }];
    });
  };

  // Update quantity
  const updateQuantity = (index: number, quantity: number) => {
    if (quantity <= 0) {
      setSelectedItems(prev => prev.filter((_, i) => i !== index));
    } else {
      setSelectedItems(prev => prev.map((item, i) => 
        i === index ? { ...item, quantity } : item
      ));
    }
  };

  // Remove item
  const removeItem = (index: number) => {
    setSelectedItems(prev => prev.filter((_, i) => i !== index));
  };

  // Calculate totals based on quality
  const costEstimate = useMemo(() => {
    let lowTotal = 0;
    let highTotal = 0;
    let avgTotal = 0;

    const itemDetails = selectedItems.map(selection => {
      const category = REHAB_CATEGORIES[selection.categoryIndex];
      const item = category.items[selection.itemIndex];
      
      // Apply quality multiplier
      const qualityMultiplier = {
        low: 0.7,
        medium: 1.0,
        high: 1.3,
      }[quality];

      const itemLow = item.lowCost * selection.quantity * qualityMultiplier;
      const itemHigh = item.highCost * selection.quantity * qualityMultiplier;
      const itemAvg = item.avgCost * selection.quantity * qualityMultiplier;

      lowTotal += itemLow;
      highTotal += itemHigh;
      avgTotal += itemAvg;

      return {
        category: category.name,
        item: item.name,
        quantity: selection.quantity,
        unit: item.unit,
        low: itemLow,
        high: itemHigh,
        avg: itemAvg,
      };
    });

    return {
      lowTotal,
      highTotal,
      avgTotal,
      itemDetails,
    };
  }, [selectedItems, quality]);

  // Get the property's existing renovation budget
  const existingBudget = property?.renovationBudget || 0;

  if (!property) {
    return (
      <div className="w-full h-full flex items-center justify-center bg-dark-900 rounded-lg">
        <div className="text-center text-dark-400">
          <p className="text-lg mb-2">No property selected</p>
          <p className="text-sm">Select a property to estimate rehab costs</p>
        </div>
      </div>
    );
  }

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-dark-700">
        <div>
          <h2 className="text-lg font-bold text-white">Rehab Cost Estimator</h2>
          <p className="text-sm text-dark-400">{property.address}</p>
        </div>
        {onClose && (
          <button
            onClick={onClose}
            className="p-2 text-dark-400 hover:text-white transition-colors"
          >
            ✕
          </button>
        )}
      </div>

      <div className="flex-1 overflow-auto p-4">
        {/* Property Info */}
        <div className="bg-dark-800 rounded-lg p-4 mb-4">
          <div className="grid grid-cols-3 gap-4 text-sm">
            <div>
              <p className="text-dark-500">Property Size</p>
              <p className="text-white font-medium">{property.sqft.toLocaleString()} sq ft</p>
            </div>
            <div>
              <p className="text-dark-500">Bed/Bath</p>
              <p className="text-white font-medium">{property.bedrooms} bed / {property.bathrooms} bath</p>
            </div>
            <div>
              <p className="text-dark-500">Existing Budget</p>
              <p className="text-amber-400 font-medium">${existingBudget.toLocaleString()}</p>
            </div>
          </div>
        </div>

        {/* Quality Selection */}
        <div className="mb-4">
          <label className="text-sm text-dark-400 block mb-2">Quality Level</label>
          <div className="flex gap-2">
            {(['low', 'medium', 'high'] as const).map((q) => (
              <button
                key={q}
                onClick={() => setQuality(q)}
                className={clsx(
                  'flex-1 py-2 rounded-lg text-sm font-medium transition-colors capitalize',
                  quality === q
                    ? 'bg-primary-500 text-white'
                    : 'bg-dark-700 text-dark-300 hover:bg-dark-600'
                )}
              >
                {q}
              </button>
            ))}
          </div>
        </div>

        {/* Category Selection */}
        <div className="mb-4">
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-2">
            Select Items
          </h3>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
            {REHAB_CATEGORIES.map((category, categoryIndex) => (
              <div key={category.name} className="bg-dark-800 rounded-lg p-3">
                <div className="flex items-center gap-2 mb-2">
                  <span className="text-lg">{category.icon}</span>
                  <span className="font-medium text-white text-sm">{category.name}</span>
                </div>
                <div className="space-y-1">
                  {category.items.slice(0, 3).map((item, itemIndex) => (
                    <button
                      key={item.name}
                      onClick={() => addItem(categoryIndex, itemIndex)}
                      className="w-full text-left text-xs text-dark-400 hover:text-white hover:bg-dark-700 px-2 py-1 rounded transition-colors"
                    >
                      {item.name} (${item.avgCost}/{item.unit})
                    </button>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Selected Items */}
        {selectedItems.length > 0 && (
          <div>
            <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-2">
              Selected Items ({selectedItems.length})
            </h3>
            <div className="space-y-2">
              {costEstimate.itemDetails.map((detail, index) => (
                <div key={index} className="bg-dark-800 rounded-lg p-3 flex items-center justify-between">
                  <div>
                    <p className="text-white text-sm">{detail.item}</p>
                    <p className="text-xs text-dark-500">{detail.category} • {detail.quantity} {detail.unit}</p>
                  </div>
                  <div className="flex items-center gap-3">
                    <div className="text-right">
                      <p className="text-white font-medium">${Math.round(detail.avg).toLocaleString()}</p>
                      <p className="text-xs text-dark-500">
                        ${Math.round(detail.low)}-${Math.round(detail.high)}
                      </p>
                    </div>
                    <div className="flex items-center gap-1">
                      <button
                        onClick={() => updateQuantity(index, selectedItems[index].quantity - 1)}
                        className="w-6 h-6 bg-dark-700 rounded text-white hover:bg-dark-600"
                      >
                        -
                      </button>
                      <span className="w-8 text-center text-white text-sm">
                        {selectedItems[index].quantity}
                      </span>
                      <button
                        onClick={() => updateQuantity(index, selectedItems[index].quantity + 1)}
                        className="w-6 h-6 bg-dark-700 rounded text-white hover:bg-dark-600"
                      >
                        +
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>

      {/* Cost Summary */}
      <div className="p-4 border-t border-dark-700 bg-dark-800">
        <div className="flex justify-between items-center mb-2">
          <span className="text-dark-400">Low Estimate</span>
          <span className="text-white font-medium">${Math.round(costEstimate.lowTotal).toLocaleString()}</span>
        </div>
        <div className="flex justify-between items-center mb-2">
          <span className="text-dark-400">Average</span>
          <span className="text-white font-bold text-lg">${Math.round(costEstimate.avgTotal).toLocaleString()}</span>
        </div>
        <div className="flex justify-between items-center mb-3">
          <span className="text-dark-400">High Estimate</span>
          <span className="text-white font-medium">${Math.round(costEstimate.highTotal).toLocaleString()}</span>
        </div>
        
        {/* Comparison to existing budget */}
        {existingBudget > 0 && (
          <div className={clsx(
            'text-sm text-center py-2 rounded',
            costEstimate.avgTotal <= existingBudget 
              ? 'bg-emerald-900/30 text-emerald-400' 
              : 'bg-red-900/30 text-red-400'
          )}>
            {costEstimate.avgTotal <= existingBudget 
              ? `Under budget by $${(existingBudget - costEstimate.avgTotal).toLocaleString()}`
              : `Over budget by $${(costEstimate.avgTotal - existingBudget).toLocaleString()}`
            }
          </div>
        )}
      </div>
    </div>
  );
}


[FILE_END: src\components\RehabEstimator.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\RentComps.tsx
TYPE: TSX
SIZE: 10454 bytes
================================================================================
'use client';

import { useState, useMemo } from 'react';
import clsx from 'clsx';
import { PropertyWithCalculations } from '@/lib/calculations';

interface RentCompsProps {
  property: PropertyWithCalculations | null;
  onClose?: () => void;
}

// Sample rent comparable data (in real app, would come from API like RentCast/Zillow)
interface RentComp {
  id: string;
  address: string;
  city: string;
  bedrooms: number;
  bathrooms: number;
  sqft: number;
  rent: number;
  distance: number;
  source: string;
  dateAdded: Date;
}

// Generate sample rent comps for demo
const generateSampleComps = (property: PropertyWithCalculations): RentComp[] => {
  const baseRent = property.estimatedRent || 1500;
  return [
    {
      id: '1',
      address: `${Math.floor(Math.random() * 9000) + 1000} Oak Street`,
      city: property.city,
      bedrooms: property.bedrooms,
      bathrooms: property.bathrooms,
      sqft: property.sqft,
      rent: Math.round(baseRent * (0.9 + Math.random() * 0.2)),
      distance: Math.random() * 0.5,
      source: 'Zillow',
      dateAdded: new Date(),
    },
    {
      id: '2',
      address: `${Math.floor(Math.random() * 9000) + 1000} Maple Ave`,
      city: property.city,
      bedrooms: property.bedrooms,
      bathrooms: property.bathrooms,
      sqft: property.sqft,
      rent: Math.round(baseRent * (0.9 + Math.random() * 0.2)),
      distance: Math.random() * 0.5,
      source: 'RentCast',
      dateAdded: new Date(),
    },
    {
      id: '3',
      address: `${Math.floor(Math.random() * 9000) + 1000} Pine Road`,
      city: property.city,
      bedrooms: property.bedrooms,
      bathrooms: property.bathrooms,
      sqft: Math.round(property.sqft * 0.9),
      rent: Math.round(baseRent * (0.85 + Math.random() * 0.2)),
      distance: Math.random() * 0.5,
      source: 'Manual',
      dateAdded: new Date(),
    },
    {
      id: '4',
      address: `${Math.floor(Math.random() * 9000) + 1000} Cedar Lane`,
      city: property.city,
      bedrooms: property.bedrooms + 1,
      bathrooms: property.bathrooms,
      sqft: Math.round(property.sqft * 1.1),
      rent: Math.round(baseRent * (1.0 + Math.random() * 0.25)),
      distance: Math.random() * 0.5,
      source: 'Zillow',
      dateAdded: new Date(),
    },
    {
      id: '5',
      address: `${Math.floor(Math.random() * 9000) + 1000} Elm Court`,
      city: property.city,
      bedrooms: property.bedrooms - 1,
      bathrooms: property.bathrooms,
      sqft: Math.round(property.sqft * 0.85),
      rent: Math.round(baseRent * (0.8 + Math.random() * 0.2)),
      distance: Math.random() * 0.5,
      source: 'RentCast',
      dateAdded: new Date(),
    },
  ];
};

export default function RentComps({ property, onClose }: RentCompsProps) {
  const [selectedComp, setSelectedComp] = useState<RentComp | null>(null);

  // Generate sample comps for selected property
  const comps = useMemo(() => {
    if (!property) return [];
    return generateSampleComps(property);
  }, [property]);

  // Calculate rent analysis
  const rentAnalysis = useMemo(() => {
    if (comps.length === 0) return null;

    const rents = comps.map(c => c.rent);
    const avgRent = rents.reduce((a, b) => a + b, 0) / rents.length;
    const minRent = Math.min(...rents);
    const maxRent = Math.max(...rents);
    const medianRent = rents.sort((a, b) => a - b)[Math.floor(rents.length / 2)];

    return {
      avgRent: Math.round(avgRent),
      minRent,
      maxRent,
      medianRent,
      propertyRent: property?.estimatedRent || 0,
      variance: avgRent - (property?.estimatedRent || 0),
      variancePercent: ((avgRent - (property?.estimatedRent || 0)) / avgRent) * 100,
    };
  }, [comps, property]);

  if (!property) {
    return (
      <div className="w-full h-full flex items-center justify-center bg-dark-900 rounded-lg">
        <div className="text-center text-dark-400">
          <p className="text-lg mb-2">No property selected</p>
          <p className="text-sm">Select a property to view rent comparables</p>
        </div>
      </div>
    );
  }

  return (
    <div className="w-full h-full flex flex-col bg-dark-900 rounded-lg overflow-hidden">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-dark-700">
        <div>
          <h2 className="text-lg font-bold text-white">Rent Comparables</h2>
          <p className="text-sm text-dark-400">{property.address}</p>
        </div>
        {onClose && (
          <button
            onClick={onClose}
            className="p-2 text-dark-400 hover:text-white transition-colors"
          >
            ✕
          </button>
        )}
      </div>

      <div className="flex-1 overflow-auto p-4">
        {/* Rent Analysis Summary */}
        {rentAnalysis && (
          <div className="bg-dark-800 rounded-lg p-4 mb-4">
            <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
              Rent Analysis
            </h3>
            
            <div className="grid grid-cols-2 gap-4 mb-4">
              <div>
                <p className="text-xs text-dark-500">Your Estimate</p>
                <p className="text-xl font-bold text-white">${rentAnalysis.propertyRent.toLocaleString()}/mo</p>
              </div>
              <div>
                <p className="text-xs text-dark-500">Market Average</p>
                <p className="text-xl font-bold text-primary-400">${rentAnalysis.avgRent.toLocaleString()}/mo</p>
              </div>
            </div>

            <div className="flex items-center gap-4 text-sm">
              <div className="flex-1">
                <div className="flex justify-between text-xs mb-1">
                  <span className="text-dark-400">${rentAnalysis.minRent.toLocaleString()}</span>
                  <span className="text-dark-400">Range</span>
                  <span className="text-dark-400">${rentAnalysis.maxRent.toLocaleString()}</span>
                </div>
                <div className="h-2 bg-dark-700 rounded-full overflow-hidden">
                  <div className="relative h-full">
                    <div 
                      className="absolute h-full bg-primary-500"
                      style={{ 
                        left: `${((rentAnalysis.propertyRent - rentAnalysis.minRent) / (rentAnalysis.maxRent - rentAnalysis.minRent)) * 100}%`,
                        width: '4px',
                        transform: 'translateX(-50%)'
                      }}
                    />
                    <div 
                      className="absolute h-full bg-dark-600 rounded-full"
                      style={{ left: 0, right: 0 }}
                    />
                  </div>
                </div>
              </div>
            </div>

            <div className={clsx(
              'mt-3 text-sm text-center py-2 rounded',
              rentAnalysis.variance >= 0 ? 'bg-emerald-900/30 text-emerald-400' : 'bg-red-900/30 text-red-400'
            )}>
              {rentAnalysis.variance >= 0 
                ? `Your estimate is $${Math.abs(rentAnalysis.variance).toLocaleString()} below market (${Math.abs(rentAnalysis.variancePercent).toFixed(1)}%)`
                : `Your estimate is $${Math.abs(rentAnalysis.variance).toLocaleString()} above market (${Math.abs(rentAnalysis.variancePercent).toFixed(1)}%)`
              }
            </div>
          </div>
        )}

        {/* Comparable Properties */}
        <div>
          <h3 className="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-3">
            Comparable Rentals ({comps.length})
          </h3>
          
          <div className="space-y-2">
            {comps.map((comp) => (
              <div
                key={comp.id}
                onClick={() => setSelectedComp(comp)}
                className={clsx(
                  'bg-dark-800 rounded-lg p-4 cursor-pointer transition-colors',
                  selectedComp?.id === comp.id ? 'ring-2 ring-primary-500' : 'hover:bg-dark-700'
                )}
              >
                <div className="flex justify-between items-start">
                  <div>
                    <p className="font-medium text-white">{comp.address}</p>
                    <p className="text-sm text-dark-400">{comp.city}</p>
                  </div>
                  <div className="text-right">
                    <p className="text-lg font-bold text-primary-400">${comp.rent.toLocaleString()}/mo</p>
                    <p className="text-xs text-dark-500">{comp.distance.toFixed(1)} mi away</p>
                  </div>
                </div>
                
                <div className="flex gap-4 mt-2 text-sm text-dark-400">
                  <span>{comp.bedrooms} bed</span>
                  <span>{comp.bathrooms} bath</span>
                  <span>{comp.sqft.toLocaleString()} sqft</span>
                  <span className="ml-auto bg-dark-700 px-2 py-0.5 rounded text-xs">
                    {comp.source}
                  </span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Selected Comp Details */}
      {selectedComp && (
        <div className="p-4 border-t border-dark-700 bg-dark-800">
          <div className="flex justify-between items-start">
            <div>
              <h3 className="font-bold text-white">{selectedComp.address}</h3>
              <p className="text-sm text-dark-400">{selectedComp.city}</p>
            </div>
            <button
              onClick={() => setSelectedComp(null)}
              className="text-dark-400 hover:text-white"
            >
              ✕
            </button>
          </div>
          
          <div className="grid grid-cols-3 gap-4 mt-4 text-sm">
            <div>
              <p className="text-dark-500">Monthly Rent</p>
              <p className="text-white font-medium">${selectedComp.rent.toLocaleString()}</p>
            </div>
            <div>
              <p className="text-dark-500">Price/SqFt</p>
              <p className="text-white font-medium">${(selectedComp.rent / selectedComp.sqft).toFixed(2)}</p>
            </div>
            <div>
              <p className="text-dark-500">Distance</p>
              <p className="text-white font-medium">{selectedComp.distance.toFixed(2)} mi</p>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


[FILE_END: src\components\RentComps.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\Sidebar.tsx
TYPE: TSX
SIZE: 9245 bytes
================================================================================
'use client';

import { useState, useEffect } from 'react';
import clsx from 'clsx';
import {
  MapIcon,
  ChartBarIcon,
  Squares2X2Icon,
  TableCellsIcon,
  MagnifyingGlassIcon,
  HomeIcon,
  Bars3Icon,
  XMarkIcon,
} from '@heroicons/react/24/outline';

export type ViewType = 'map' | 'scatter' | 'kanban' | 'table';

interface SidebarProps {
  currentView: ViewType;
  onViewChange: (view: ViewType) => void;
  searchQuery: string;
  onSearchChange: (query: string) => void;
  propertyCount?: number;
  platinumCount?: number;
}

const navigationItems = [
  { id: 'map' as ViewType, name: 'Opportunity Map', icon: MapIcon },
  { id: 'scatter' as ViewType, name: 'Value Analysis', icon: ChartBarIcon },
  { id: 'kanban' as ViewType, name: 'Strategy Board', icon: Squares2X2Icon },
  { id: 'table' as ViewType, name: 'Data Grid', icon: TableCellsIcon },
];

export default function Sidebar({
  currentView,
  onViewChange,
  searchQuery,
  onSearchChange,
  propertyCount = 25,
  platinumCount = 8,
}: SidebarProps) {
  const [isCollapsed, setIsCollapsed] = useState(false);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
      if (window.innerWidth >= 768) {
        setIsMobileMenuOpen(false);
      }
    };
    
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  // Close mobile menu when view changes
  const handleViewChange = (view: ViewType) => {
    onViewChange(view);
    if (isMobile) {
      setIsMobileMenuOpen(false);
    }
  };

  // Mobile header with hamburger menu
  if (isMobile) {
    return (
      <>
        {/* Mobile Header */}
        <header className="fixed top-0 left-0 right-0 h-14 bg-dark-900 border-b border-dark-700 z-50 flex items-center justify-between px-4">
          <div className="flex items-center gap-2">
            <HomeIcon className="w-5 h-5 text-primary-500" />
            <span className="font-semibold">Deal Triage</span>
          </div>
          <button
            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
            className="p-2 rounded-lg hover:bg-dark-700 transition-colors"
            aria-label={isMobileMenuOpen ? 'Close menu' : 'Open menu'}
          >
            {isMobileMenuOpen ? (
              <XMarkIcon className="w-6 h-6" />
            ) : (
              <Bars3Icon className="w-6 h-6" />
            )}
          </button>
        </header>

        {/* Mobile Menu Overlay */}
        {isMobileMenuOpen && (
          <div
            className="fixed inset-0 bg-black/50 z-40 md:hidden"
            onClick={() => setIsMobileMenuOpen(false)}
          />
        )}

        {/* Mobile Menu */}
        <div
          className={clsx(
            'fixed top-14 left-0 right-0 bg-dark-900 border-b border-dark-700 z-40 transition-transform duration-300 md:hidden',
            isMobileMenuOpen ? 'translate-y-0' : '-translate-y-full'
          )}
        >
          {/* Search */}
          <div className="p-4 border-b border-dark-700">
            <div className="relative">
              <MagnifyingGlassIcon className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400" />
              <input
                type="text"
                placeholder="Search rationale..."
                value={searchQuery}
                onChange={(e) => onSearchChange(e.target.value)}
                className="w-full pl-9 pr-4 py-2 bg-dark-800 border border-dark-600 rounded-lg text-sm focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-colors"
              />
            </div>
          </div>

          {/* Navigation */}
          <nav className="p-2">
            {navigationItems.map((item) => {
              const Icon = item.icon;
              const isActive = currentView === item.id;
              
              return (
                <button
                  key={item.id}
                  onClick={() => handleViewChange(item.id)}
                  className={clsx(
                    'w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-all duration-200 mb-1',
                    isActive
                      ? 'bg-primary-500/20 text-primary-400 border border-primary-500/30'
                      : 'text-dark-300 hover:bg-dark-700 hover:text-dark-100'
                  )}
                >
                  <Icon className="w-5 h-5 flex-shrink-0" />
                  <span className="font-medium">{item.name}</span>
                </button>
              );
            })}
          </nav>

          {/* Stats */}
          <div className="p-4 border-t border-dark-700">
            <div className="grid grid-cols-2 gap-2 text-center">
              <div className="bg-dark-800 rounded-lg p-3">
                <div className="text-xl font-bold text-primary-400">{propertyCount}</div>
                <div className="text-xs text-dark-400">Properties</div>
              </div>
              <div className="bg-dark-800 rounded-lg p-3">
                <div className="text-xl font-bold text-emerald-400">{platinumCount}</div>
                <div className="text-xs text-dark-400">Platinum</div>
              </div>
            </div>
          </div>
        </div>

        {/* Spacer for mobile header */}
        <div className="h-14 md:hidden" />
      </>
    );
  }

  // Desktop Sidebar
  return (
    <aside
      className={clsx(
        'fixed left-0 top-0 h-full bg-dark-900 border-r border-dark-700 transition-all duration-300 z-50',
        isCollapsed ? 'w-16' : 'w-64'
      )}
    >
      {/* Logo Section */}
      <div className="flex items-center justify-between h-16 px-4 border-b border-dark-700">
        {!isCollapsed && (
          <div className="flex items-center gap-2">
            <HomeIcon className="w-6 h-6 text-primary-500" />
            <span className="font-semibold text-lg">Deal Triage</span>
          </div>
        )}
        <button
          onClick={() => setIsCollapsed(!isCollapsed)}
          className="p-2 rounded-lg hover:bg-dark-700 transition-colors"
          aria-label={isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'}
        >
          <svg
            className={clsx('w-5 h-5 transition-transform', isCollapsed && 'rotate-180')}
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
          </svg>
        </button>
      </div>

      {/* Search Section */}
      {!isCollapsed && (
        <div className="p-4 border-b border-dark-700">
          <div className="relative">
            <MagnifyingGlassIcon className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400" />
            <input
              type="text"
              placeholder="Search rationale..."
              value={searchQuery}
              onChange={(e) => onSearchChange(e.target.value)}
              className="w-full pl-9 pr-4 py-2 bg-dark-800 border border-dark-600 rounded-lg text-sm focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-colors"
            />
          </div>
          <p className="mt-2 text-xs text-dark-400">
            Try: &ldquo;Foreclosure&rdquo;, &ldquo;Rent Ready&rdquo;, &ldquo;Price cut&rdquo;
          </p>
        </div>
      )}

      {/* Navigation */}
      <nav className="p-2 mt-2">
        {navigationItems.map((item) => {
          const Icon = item.icon;
          const isActive = currentView === item.id;
          
          return (
            <button
              key={item.id}
              onClick={() => onViewChange(item.id)}
              className={clsx(
                'w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 mb-1',
                isActive
                  ? 'bg-primary-500/20 text-primary-400 border border-primary-500/30'
                  : 'text-dark-300 hover:bg-dark-700 hover:text-dark-100'
              )}
              title={isCollapsed ? item.name : undefined}
            >
              <Icon className="w-5 h-5 flex-shrink-0" />
              {!isCollapsed && <span className="font-medium">{item.name}</span>}
            </button>
          );
        })}
      </nav>

      {/* Stats Section */}
      {!isCollapsed && (
        <div className="absolute bottom-0 left-0 right-0 p-4 border-t border-dark-700">
          <div className="grid grid-cols-2 gap-2 text-center">
            <div className="bg-dark-800 rounded-lg p-2">
              <div className="text-xl font-bold text-primary-400">{propertyCount}</div>
              <div className="text-xs text-dark-400">Properties</div>
            </div>
            <div className="bg-dark-800 rounded-lg p-2">
              <div className="text-xl font-bold text-emerald-400">{platinumCount}</div>
              <div className="text-xs text-dark-400">Platinum</div>
            </div>
          </div>
        </div>
      )}
    </aside>
  );
}


[FILE_END: src\components\Sidebar.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\StrategyKanban.tsx
TYPE: TSX
SIZE: 13851 bytes
================================================================================
'use client';

import { useMemo, useState } from 'react';
import clsx from 'clsx';
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  DragOverlay,
  DragStartEvent,
  DragEndEvent,
} from '@dnd-kit/core';
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  rectSortingStrategy,
  useSortable,
} from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
import { Strategy, getDecisionColor } from '@/data/properties';
import { PropertyWithCalculations } from '@/lib/calculations';

interface StrategyKanbanProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
}

const strategyConfig: { strategy: Strategy; label: string; color: string; icon: string }[] = [
  { strategy: 'Retail Flip', label: 'Retail Flip', color: '#3b82f6', icon: '🏠' },
  { strategy: 'Section 8', label: 'Section 8', color: '#22c55e', icon: '🏘️' },
  { strategy: 'BRRR', label: 'BRRR', color: '#a855f7', icon: '🔄' },
  { strategy: 'Owner Finance', label: 'Owner Finance', color: '#06b6d4', icon: '💰' },
  { strategy: 'Wholesaling', label: 'Wholesaling', color: '#ec4899', icon: '🤝' },
];

// Sortable Card Component
interface SortableCardProps {
  property: PropertyWithCalculations;
  isDragging?: boolean;
  selected?: boolean;
  onSelect?: () => void;
}

const SortableCard = ({ property, isDragging, selected, onSelect }: SortableCardProps) => {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging: dndDragging,
  } = useSortable({ id: property.id });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging || dndDragging ? 0.5 : 1,
    zIndex: isDragging || dndDragging ? 999 : 'auto',
  };

  const getDecisionBadgeClass = (decision: PropertyWithCalculations['decision']) => {
    switch (decision) {
      case 'Pass Platinum':
        return 'decision-platinum';
      case 'Pass Gold':
        return 'decision-gold';
      case 'Pass Silver':
        return 'decision-silver';
      case 'Hard Fail':
        return 'decision-hardfail';
      case 'Caution':
        return 'decision-caution';
      default:
        return '';
    }
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      onClick={onSelect}
      className={clsx(
        'kanban-card bg-dark-800 border border-dark-600 rounded-lg p-3 cursor-grab active:cursor-grabbing transition-all',
        selected && 'ring-2 ring-primary-500'
      )}
      {...attributes}
      {...listeners}
    >
      {/* Card Header */}
      <div className="flex items-start justify-between mb-2">
        <div className="flex-1 min-w-0">
          <div className="text-sm font-medium text-white truncate">
            {property.address}
          </div>
          <div className="text-xs text-dark-400">
            {property.city}, {property.state}
          </div>
        </div>
        <span className={clsx('decision-badge ml-2', getDecisionBadgeClass(property.decision))}>
          {property.decision.split(' ')[1] || property.decision}
        </span>
      </div>

      {/* Key Metrics */}
      <div className="grid grid-cols-2 gap-2 text-xs mb-2">
        <div>
          <span className="text-dark-400">Price: </span>
          <span className="text-emerald-400 font-medium">
            ${property.listPrice.toLocaleString()}
          </span>
        </div>
        <div>
          <span className="text-dark-400">Equity: </span>
          <span className="text-amber-400 font-medium">
            ${property.equityGap.toLocaleString()}
          </span>
        </div>
        <div>
          <span className="text-dark-400">SqFt: </span>
          <span>{property.sqft.toLocaleString()}</span>
        </div>
        <div>
           <span className="text-dark-400">$/SqFt: </span>
           <span className="text-primary-400">
             ${property.pricePerSqft.toFixed(0)}
           </span>
         </div>
      </div>

      {/* Beds/Baths */}
      <div className="flex items-center gap-3 text-xs text-dark-400">
        <span>🛏️ {property.bedrooms}</span>
        <span>🚿 {property.bathrooms}</span>
      </div>

      {/* Expanded Details */}
      {selected && (
        <div className="mt-3 pt-3 border-t border-dark-600 animate-fade-in">
          <div className="text-xs text-dark-300 mb-2">
            {property.rationale}
          </div>
          <a
             href={property.url ?? '#'}
             target="_blank"
             rel="noopener noreferrer"
             className="text-xs text-primary-400 hover:text-primary-300"
             onClick={(e) => e.stopPropagation()}
           >
             View on Zillow →
           </a>
        </div>
      )}
    </div>
  );
};

export default function StrategyKanban({ properties, onPropertyClick }: StrategyKanbanProps) {
  const [selectedProperty, setSelectedProperty] = useState<string | null>(null);
  const [activeId, setActiveId] = useState<string | null>(null);
  const [groupedProperties, setGroupedProperties] = useState<Record<Strategy, PropertyWithCalculations[]>>(() => {
    const groups: Record<Strategy, PropertyWithCalculations[]> = {
      'Retail Flip': [],
      'Section 8': [],
      'BRRR': [],
      'Owner Finance': [],
      'Wholesaling': [],
    };

    properties.forEach((property) => {
      groups[property.strategy as Strategy].push(property);
    });

    return groups;
  });

  // Initialize sensors for drag-and-drop
  const sensors = useSensors(
    useSensor(PointerSensor, {
      activationConstraint: {
        distance: 8,
      },
    }),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  );

  // Handle drag start
  const handleDragStart = (event: DragStartEvent) => {
    setActiveId(event.active.id as string);
  };

  // Handle drag end
  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;

    if (!over) {
      setActiveId(null);
      return;
    }

    // Find source and destination columns
    let sourceColumn: Strategy | null = null;
    let destColumn: Strategy | null = null;

    Object.entries(groupedProperties).forEach(([strategy, props]) => {
      if (props.some((p) => p.id === active.id)) {
        sourceColumn = strategy as Strategy;
      }
      if (over.id.toString().startsWith('column-')) {
        destColumn = over.id.toString().replace('column-', '') as Strategy;
      } else if (props.some((p) => p.id === over.id)) {
        // If dropped on a card, find the column
        destColumn = strategy as Strategy;
      }
    });

    if (!sourceColumn) {
      setActiveId(null);
      return;
    }

    if (sourceColumn === destColumn) {
      // Reorder within the same column
      const sourceItems = [...groupedProperties[sourceColumn]] as PropertyWithCalculations[];
      const activeIndex = sourceItems.findIndex((p) => p.id === active.id);
      const overId = over.id as string;
      const overIndex = sourceItems.findIndex((p) => p.id === overId);

      if (activeIndex !== overIndex) {
        const reordered = arrayMove(sourceItems, activeIndex, overIndex);
        setGroupedProperties((prev) => ({
          ...prev,
          [sourceColumn as string]: reordered,
        }));
      }
    } else if (destColumn) {
      // Move to different column
      const sourceItems = [...groupedProperties[sourceColumn]] as PropertyWithCalculations[];
      const destItems = [...groupedProperties[destColumn]] as PropertyWithCalculations[];
      const activeIndex = sourceItems.findIndex((p) => p.id === active.id);

      if (activeIndex !== -1) {
        const [movedProperty] = sourceItems.splice(activeIndex, 1);
        const updatedProperty = {
          ...movedProperty,
          strategy: destColumn,
        };

        // Find the position to insert
        if (over.id.toString().startsWith('column-')) {
          destItems.push(updatedProperty);
        } else {
          const overIndex = destItems.findIndex((p) => p.id === over.id);
          destItems.splice(overIndex + 1, 0, updatedProperty);
        }

        setGroupedProperties((prev) => ({
          ...prev,
          [sourceColumn as string]: sourceItems,
          [destColumn as string]: destItems,
        }));
      }
    }

    setActiveId(null);
  };

  const totalEquityGap = useMemo(() => {
    return Object.values(groupedProperties).flat().reduce((sum, p) => sum + p.equityGap, 0);
  }, [groupedProperties]);

  const activeProperty = useMemo(() => {
    return activeId ? Object.values(groupedProperties)
      .flat()
      .find((p) => p.id === activeId) : null;
  }, [activeId, groupedProperties]);

  return (
    <DndContext
      sensors={sensors}
      collisionDetection={closestCenter}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
    >
      <div className="w-full h-full flex flex-col">
        {/* Header Stats */}
        <div className="grid grid-cols-5 gap-4 mb-4">
          {strategyConfig.map(({ strategy, label, color, icon }) => {
            const props = groupedProperties[strategy];
            const totalEquity = props.reduce((sum, p) => sum + p.equityGap, 0);
            
            return (
              <div
                key={strategy}
                className="bg-dark-800 rounded-lg p-3 border border-dark-700"
                style={{ borderLeftColor: color, borderLeftWidth: 3 }}
              >
                <div className="flex items-center gap-2 mb-1">
                  <span>{icon}</span>
                  <span className="text-xs font-medium text-dark-300">{label}</span>
                </div>
                <div className="text-lg font-bold text-white">{props.length}</div>
                <div className="text-xs text-emerald-400">
                  ${totalEquity.toLocaleString()} equity
                </div>
              </div>
            );
          })}
        </div>

        {/* Total Equity Summary */}
        <div className="bg-gradient-to-r from-primary-500/20 to-emerald-500/20 rounded-lg p-4 mb-4 border border-primary-500/30">
          <div className="flex items-center justify-between">
            <div>
              <div className="text-sm text-dark-300">Total Portfolio Equity Gap</div>
              <div className="text-2xl font-bold text-white">
                ${totalEquityGap.toLocaleString()}
              </div>
            </div>
            <div className="text-right">
              <div className="text-sm text-dark-300">Properties Analyzed</div>
              <div className="text-2xl font-bold text-primary-400">
                {Object.values(groupedProperties).flat().length}
              </div>
            </div>
          </div>
        </div>

        {/* Kanban Board */}
        <div className="flex-1 overflow-x-auto">
          <div className="flex gap-4 min-w-max h-full">
            {strategyConfig.map(({ strategy, label, color, icon }) => {
              const columnProperties = groupedProperties[strategy];
              
              return (
                <div
                  key={strategy}
                  className="kanban-column flex-shrink-0 w-72"
                  style={{ borderTopColor: color, borderTopWidth: 3 }}
                >
                  {/* Column Header */}
                  <div className="flex items-center justify-between mb-3 pb-2 border-b border-dark-600">
                    <div className="flex items-center gap-2">
                      <span className="text-lg">{icon}</span>
                      <span className="font-semibold text-white">{label}</span>
                    </div>
                    <span
                      className="px-2 py-0.5 rounded-full text-xs font-bold"
                      style={{ backgroundColor: `${color}30`, color }}
                    >
                      {columnProperties.length}
                    </span>
                  </div>

                  {/* Cards */}
                  <div
                    id={`column-${strategy}`}
                    className="space-y-3 max-h-[calc(100vh-400px)] overflow-y-auto pr-1"
                  >
                    <SortableContext
                      items={columnProperties.map((p) => p.id)}
                      strategy={rectSortingStrategy}
                    >
                      {columnProperties.length === 0 ? (
                        <div className="text-center py-8 text-dark-500 text-sm">
                          No properties
                        </div>
                      ) : (
                        columnProperties.map((property) => (
                          <SortableCard
                            key={property.id}
                            property={property}
                            isDragging={activeId === property.id}
                            selected={selectedProperty === property.id}
                            onSelect={() => {
                              setSelectedProperty(
                                selectedProperty === property.id ? null : property.id
                              );
                              onPropertyClick?.(property);
                            }}
                          />
                        ))
                      )}
                    </SortableContext>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </div>

      {/* Drag Overlay */}
      <DragOverlay>
        {activeProperty ? (
          <SortableCard
            property={activeProperty}
            isDragging={true}
            selected={selectedProperty === activeProperty.id}
          />
        ) : null}
      </DragOverlay>
    </DndContext>
  );
}


[FILE_END: src\components\StrategyKanban.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\TaskManager.tsx
TYPE: TSX
SIZE: 1341 bytes
================================================================================
'use client';
import { useState } from 'react';

export default function TaskManager({ propertyId }: { propertyId: string }) {
  const [tasks, setTasks] = useState<{id: string, title: string, isCompleted: boolean}[]>([]);
  const [newTask, setNewTask] = useState('');

  const addTask = () => {
    if (!newTask) return;
    setTasks([...tasks, { id: Date.now().toString(), title: newTask, isCompleted: false }]);
    setNewTask('');
    // TODO: Call API to save to DB
  };

  return (
    <div className="bg-dark-800 p-6 rounded-lg border border-dark-700">
      <h3 className="text-lg font-semibold text-white mb-4">Tasks</h3>
      <div className="flex gap-2 mb-4">
        <input 
          className="bg-dark-900 border border-dark-600 rounded p-2 text-sm text-white w-full"
          placeholder="Add a task..."
          value={newTask}
          onChange={(e) => setNewTask(e.target.value)}
        />
        <button onClick={addTask} className="bg-primary-600 px-4 rounded text-white text-sm">Add</button>
      </div>
      <div className="space-y-2">
        {tasks.map(task => (
          <div key={task.id} className="flex items-center gap-2 text-white">
            <input type="checkbox" checked={task.isCompleted} readOnly />
            <span>{task.title}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

[FILE_END: src\components\TaskManager.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\components\ValueScatterPlot.tsx
TYPE: TSX
SIZE: 9867 bytes
================================================================================
'use client';

import { useMemo, useState } from 'react';
import {
  ScatterChart,
  Scatter,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  ReferenceLine,
  Cell,
} from 'recharts';
import { getDecisionColor, Decision } from '@/data/properties';
import { PropertyWithCalculations } from '@/lib/calculations';

interface ValueScatterPlotProps {
  properties: PropertyWithCalculations[];
  onPropertyClick?: (property: PropertyWithCalculations) => void;
}

interface ChartData {
  x: number;
  y: number;
  size: number;
  property: PropertyWithCalculations;
  isOutlier: boolean;
}

export default function ValueScatterPlot({ properties, onPropertyClick }: ValueScatterPlotProps) {
  const [selectedDecision, setSelectedDecision] = useState<Decision | 'all'>('all');
  const [showTrendLine, setShowTrendLine] = useState(true);

  const averagePricePerSqft = useMemo(() => {
    const validProperties = properties.filter(p => p.sqft > 0);
    if (validProperties.length === 0) return 0;
    const total = validProperties.reduce((sum, p) => sum + p.pricePerSqft, 0);
    return total / validProperties.length;
  }, [properties]);

  const chartData: ChartData[] = useMemo(() => {
    const maxPrice = Math.max(...properties.map(p => p.listPrice));
    const minSize = 100;
    const maxSize = 1000;

    return properties
      .filter(p => p.sqft > 0)
      .filter(p => selectedDecision === 'all' || p.decision === selectedDecision)
      .map(p => {
        const pricePerSqft = p.pricePerSqft;
        const normalizedSize = minSize + ((p.listPrice / maxPrice) * (maxSize - minSize));
        return {
          x: p.sqft,
          y: pricePerSqft,
          size: normalizedSize,
          property: p,
          isOutlier: pricePerSqft < averagePricePerSqft * 0.7,
        };
      });
  }, [properties, selectedDecision, averagePricePerSqft]);

  const outlierCount = chartData.filter(d => d.isOutlier).length;

  const decisionFilters: { value: Decision | 'all'; label: string; color: string }[] = [
    { value: 'all', label: 'All', color: '#64748b' },
    { value: 'Pass Platinum', label: 'Platinum', color: '#10b981' },
    { value: 'Pass Gold', label: 'Gold', color: '#f59e0b' },
    { value: 'Pass Silver', label: 'Silver', color: '#f97316' },
    { value: 'Hard Fail', label: 'Hard Fail', color: '#ef4444' },
    { value: 'Caution', label: 'Caution', color: '#8b5cf6' },
  ];

  const CustomTooltip = ({ active, payload }: { active?: boolean; payload?: Array<{ payload: ChartData }> }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;
      const { property } = data;
      
      return (
        <div className="bg-dark-800 border border-dark-600 rounded-lg p-3 shadow-xl max-w-xs">
          <div className="font-semibold text-white mb-2">{property.address}</div>
          <div className="space-y-1 text-sm">
            <div className="flex justify-between gap-4">
              <span className="text-dark-400">List Price:</span>
              <span className="text-emerald-400 font-medium">
                ${property.listPrice.toLocaleString()}
              </span>
            </div>
            <div className="flex justify-between gap-4">
              <span className="text-dark-400">SqFt:</span>
              <span>{property.sqft.toLocaleString()}</span>
            </div>
            <div className="flex justify-between gap-4">
               <span className="text-dark-400">$/SqFt:</span>
               <span className={data.isOutlier ? 'text-emerald-400 font-bold' : ''}>
                 ${property.pricePerSqft.toFixed(2)}
               </span>
             </div>
            <div className="flex justify-between gap-4">
              <span className="text-dark-400">Decision:</span>
              <span style={{ color: getDecisionColor(property.decision as Decision) }}>
                {property.decision}
              </span>
            </div>
            <div className="flex justify-between gap-4">
              <span className="text-dark-400">Strategy:</span>
              <span className="text-primary-400">{property.strategy}</span>
            </div>
          </div>
          {data.isOutlier && (
            <div className="mt-2 pt-2 border-t border-dark-600">
              <span className="text-xs text-emerald-400 font-medium">
                ⭐ Below Average - Potential Value!
              </span>
            </div>
          )}
        </div>
      );
    }
    return null;
  };

  return (
    <div className="w-full h-full flex flex-col">
      {/* Controls */}
      <div className="flex flex-wrap items-center justify-between gap-4 mb-4">
        <div className="flex flex-wrap gap-2">
          {decisionFilters.map((filter) => (
            <button
              key={filter.value}
              onClick={() => setSelectedDecision(filter.value)}
              className={`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${
                selectedDecision === filter.value
                  ? 'ring-2 ring-offset-2 ring-offset-dark-800'
                  : 'opacity-60 hover:opacity-100'
              }`}
              style={{ 
                backgroundColor: `${filter.color}20`,
                color: filter.color,
                '--tw-ring-color': filter.color,
              } as React.CSSProperties}
            >
              {filter.label}
            </button>
          ))}
        </div>
        
        <div className="flex items-center gap-4">
          <label className="flex items-center gap-2 text-sm text-dark-300">
            <input
              type="checkbox"
              checked={showTrendLine}
              onChange={(e) => setShowTrendLine(e.target.checked)}
              className="rounded border-dark-600 bg-dark-700 text-primary-500 focus:ring-primary-500"
            />
            Show Average Line
          </label>
        </div>
      </div>

      {/* Stats Summary */}
      <div className="grid grid-cols-3 gap-4 mb-4">
        <div className="bg-dark-800 rounded-lg p-3 border border-dark-700">
          <div className="text-xs text-dark-400 mb-1">Average $/SqFt</div>
          <div className="text-xl font-bold text-primary-400">
            ${averagePricePerSqft.toFixed(2)}
          </div>
        </div>
        <div className="bg-dark-800 rounded-lg p-3 border border-dark-700">
          <div className="text-xs text-dark-400 mb-1">Properties Shown</div>
          <div className="text-xl font-bold text-white">{chartData.length}</div>
        </div>
        <div className="bg-dark-800 rounded-lg p-3 border border-dark-700">
          <div className="text-xs text-dark-400 mb-1">Value Outliers</div>
          <div className="text-xl font-bold text-emerald-400">{outlierCount}</div>
        </div>
      </div>

      {/* Chart */}
      <div className="flex-1 min-h-[400px] bg-dark-800 rounded-lg border border-dark-700 p-4">
        <ResponsiveContainer width="100%" height="100%">
          <ScatterChart
            margin={{ top: 20, right: 20, bottom: 60, left: 60 }}
          >
            <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
            <XAxis
              type="number"
              dataKey="x"
              name="Square Footage"
              tick={{ fill: '#94a3b8', fontSize: 12 }}
              axisLine={{ stroke: '#475569' }}
              tickLine={{ stroke: '#475569' }}
              label={{ 
                value: 'Square Footage', 
                position: 'bottom',
                fill: '#94a3b8',
                fontSize: 12,
                offset: 40,
              }}
            />
            <YAxis
              type="number"
              dataKey="y"
              name="Price per SqFt"
              tick={{ fill: '#94a3b8', fontSize: 12 }}
              axisLine={{ stroke: '#475569' }}
              tickLine={{ stroke: '#475569' }}
              label={{ 
                value: 'Price per SqFt ($)', 
                angle: -90,
                position: 'left',
                fill: '#94a3b8',
                fontSize: 12,
                offset: 40,
              }}
            />
            <Tooltip content={<CustomTooltip />} />
            
            {showTrendLine && (
              <ReferenceLine
                y={averagePricePerSqft}
                stroke="#f59e0b"
                strokeDasharray="5 5"
                label={{
                  value: `Avg: $${averagePricePerSqft.toFixed(0)}/sqft`,
                  position: 'right',
                  fill: '#f59e0b',
                  fontSize: 11,
                }}
              />
            )}
            
            <Scatter
              name="Properties"
              data={chartData}
              onClick={(data) => onPropertyClick?.(data.property)}
            >
              {chartData.map((entry, index) => (
                <Cell
                  key={`cell-${index}`}
                  fill={getDecisionColor(entry.property.decision as Decision)}
                  stroke={entry.isOutlier ? '#10b981' : 'transparent'}
                  strokeWidth={entry.isOutlier ? 2 : 0}
                  style={{ cursor: 'pointer' }}
                />
              ))}
            </Scatter>
          </ScatterChart>
        </ResponsiveContainer>
      </div>

      {/* Legend */}
      <div className="mt-4 flex flex-wrap items-center justify-center gap-4 text-xs text-dark-400">
        <div className="flex items-center gap-2">
          <div className="w-4 h-4 rounded-full bg-dark-400" />
          <span>Bubble size = List Price</span>
        </div>
        <div className="flex items-center gap-2">
          <div className="w-4 h-4 rounded-full border-2 border-emerald-500" />
          <span>Green border = Below average (value opportunity)</span>
        </div>
      </div>
    </div>
  );
}


[FILE_END: src\components\ValueScatterPlot.tsx]
################################################################################

================================================================================
FILE_BEGIN: src\context\PropertyContext.tsx
TYPE: TSX
SIZE: 9657 bytes
================================================================================
'use client';

import { createContext, useContext, useState, useCallback, useEffect, ReactNode, useRef } from 'react';
import { 
  Decision, 
  Strategy, 
} from '@/data/properties';
import { 
  PropertyWithCalculations, 
  PropertyBase,
  addCalculations 
} from '@/lib/calculations';

// Re-export for convenience
export type { PropertyWithCalculations } from '@/lib/calculations';

interface PropertyContextType {
  properties: PropertyWithCalculations[];
  loading: boolean;
  error: string | null;
  selectedProperty: PropertyWithCalculations | null;
  filters: PropertyFilters;
  setSelectedProperty: (property: PropertyWithCalculations | null) => void;
  setFilters: (filters: PropertyFilters) => void;
  refreshProperties: () => Promise<void>;
  updateProperty: (id: string, data: Partial<PropertyBase>) => Promise<void>;
  deleteProperty: (id: string) => Promise<void>;
  addProperty: (property: Omit<PropertyBase, 'id' | 'createdAt' | 'updatedAt'>) => Promise<void>;
  getPropertyById: (id: string) => PropertyWithCalculations | undefined;
  getPropertiesByStrategy: (strategy: Strategy) => PropertyWithCalculations[];
  getPropertiesByDecision: (decision: Decision) => PropertyWithCalculations[];
  searchProperties: (query: string) => PropertyWithCalculations[];
  // Favorites/Watchlist
  favoriteProperties: PropertyWithCalculations[];
  toggleFavorite: (id: string) => Promise<void>;
  isFavorite: (id: string) => boolean;
}

interface PropertyFilters {
  search: string;
  strategy: Strategy | '';
  decision: Decision | '';
  city: string;
  minPrice: number;
  maxPrice: number;
  minEquity: number;
}

const defaultFilters: PropertyFilters = {
  search: '',
  strategy: '',
  decision: '',
  city: '',
  minPrice: 0,
  maxPrice: Infinity,
  minEquity: 0,
};

const PropertyContext = createContext<PropertyContextType | undefined>(undefined);

interface PropertyProviderProps {
  children: ReactNode;
  /** 
   * Initial data from server-side rendering.
   * When provided, the context will skip the initial fetch and use this data instead,
   * eliminating the "double fetch" pattern.
   */
  initialData?: PropertyWithCalculations[];
}

export function PropertyProvider({ children, initialData }: PropertyProviderProps) {
  // Initialize with server-side data if provided, otherwise empty array
  const [properties, setProperties] = useState<PropertyWithCalculations[]>(initialData ?? []);
  // Start loading as false if we have initial data
  const [loading, setLoading] = useState(!initialData);
  const [error, setError] = useState<string | null>(null);
  const [selectedProperty, setSelectedProperty] = useState<PropertyWithCalculations | null>(null);
  const [filters, setFilters] = useState<PropertyFilters>(defaultFilters);
  
  // Track if this is the first render to avoid double fetch
  const isInitialMount = useRef(true);
  // Track if we have initial data to skip first fetch
  const hasInitialData = useRef(!!initialData);

  const fetchProperties = useCallback(async (currentFilters: PropertyFilters) => {
    try {
      setLoading(true);
      setError(null);

      const params = new URLSearchParams();
      if (currentFilters.search) params.append('search', currentFilters.search);
      if (currentFilters.strategy) params.append('strategy', currentFilters.strategy);
      if (currentFilters.decision) params.append('decision', currentFilters.decision);
      if (currentFilters.city) params.append('city', currentFilters.city);

      const response = await fetch(`/api/properties?${params.toString()}`);
      
      if (!response.ok) {
        throw new Error(`Failed to fetch properties: ${response.status}`);
      }

      const data = await response.json();
      let fetchedProperties = data.data as PropertyWithCalculations[];

      // Apply client-side filters for min/max price and equity
      // This is a pragmatic choice for smaller datasets - allows instant UI updates
      // on price sliders without hitting the database
      if (currentFilters.minPrice > 0) {
        fetchedProperties = fetchedProperties.filter(p => p.listPrice >= currentFilters.minPrice);
      }
      if (currentFilters.maxPrice < Infinity) {
        fetchedProperties = fetchedProperties.filter(p => p.listPrice <= currentFilters.maxPrice);
      }
      if (currentFilters.minEquity > 0) {
        fetchedProperties = fetchedProperties.filter(p => p.equityGap >= currentFilters.minEquity);
      }

      setProperties(fetchedProperties);
    } catch (err) {
      console.error('Error fetching properties:', err);
      setError(err instanceof Error ? err.message : 'Failed to fetch properties');
    } finally {
      setLoading(false);
    }
  }, []);

  // Only fetch when filters change, and skip initial fetch if we have initialData
  useEffect(() => {
    // Skip the first fetch if we have initial data from server
    if (isInitialMount.current) {
      isInitialMount.current = false;
      if (hasInitialData.current) {
        // We already have data from server, no need to fetch
        return;
      }
    }
    
    fetchProperties(filters);
  }, [filters, fetchProperties]);

  const refreshProperties = useCallback(async () => {
    await fetchProperties(filters);
  }, [filters, fetchProperties]);

  const updateProperty = useCallback(async (id: string, data: Partial<PropertyBase>) => {
    try {
      const response = await fetch('/api/properties', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, ...data }),
      });

      if (!response.ok) {
        throw new Error(`Failed to update property: ${response.status}`);
      }

      const result = await response.json();
      // Use the shared calculation utility
      const updatedProperty = addCalculations(result.data);
      
      setProperties(prev => 
        prev.map(p => p.id === id ? updatedProperty : p)
      );
    } catch (err) {
      console.error('Error updating property:', err);
      throw err;
    }
  }, []);

  const deleteProperty = useCallback(async (id: string) => {
    try {
      const response = await fetch(`/api/properties?id=${id}`, {
        method: 'DELETE',
      });

      if (!response.ok) {
        throw new Error(`Failed to delete property: ${response.status}`);
      }

      setProperties(prev => prev.filter(p => p.id !== id));
    } catch (err) {
      console.error('Error deleting property:', err);
      throw err;
    }
  }, []);

  const addProperty = useCallback(async (propertyData: Omit<PropertyBase, 'id' | 'createdAt' | 'updatedAt'>) => {
    try {
      const response = await fetch('/api/properties', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(propertyData),
      });

      if (!response.ok) {
        throw new Error(`Failed to add property: ${response.status}`);
      }

      const result = await response.json();
      // Use the shared calculation utility
      const newProperty = addCalculations(result.data);
      
      setProperties(prev => [...prev, newProperty]);
    } catch (err) {
      console.error('Error adding property:', err);
      throw err;
    }
  }, []);

  const getPropertyById = useCallback((id: string) => {
    return properties.find(p => p.id === id);
  }, [properties]);

  const getPropertiesByStrategy = useCallback((strategy: Strategy) => {
    return properties.filter(p => p.strategy === strategy);
  }, [properties]);

  const getPropertiesByDecision = useCallback((decision: Decision) => {
    return properties.filter(p => p.decision === decision);
  }, [properties]);

  const searchProperties = useCallback((query: string) => {
    if (!query.trim()) return properties;
    const lowerQuery = query.toLowerCase();
    return properties.filter(p =>
      p.address.toLowerCase().includes(lowerQuery) ||
      p.city.toLowerCase().includes(lowerQuery) ||
      p.rationale.toLowerCase().includes(lowerQuery) ||
      (p.details?.toLowerCase().includes(lowerQuery) ?? false)
    );
  }, [properties]);

  // Favorites/Watchlist - derived from properties with isFavorite flag
  const favoriteProperties = useCallback(() => {
    return properties.filter(p => (p as any).isFavorite === true);
  }, [properties])();

  const isFavorite = useCallback((id: string) => {
    const property = properties.find(p => p.id === id);
    return property ? (property as any).isFavorite === true : false;
  }, [properties]);

  const toggleFavorite = useCallback(async (id: string) => {
    const property = properties.find(p => p.id === id);
    if (!property) return;
    
    const currentFavorite = (property as any).isFavorite === true;
    try {
      await updateProperty(id, { isFavorite: !currentFavorite } as any);
    } catch (err) {
      console.error('Error toggling favorite:', err);
      throw err;
    }
  }, [properties, updateProperty]);

  const value: PropertyContextType = {
    properties,
    loading,
    error,
    selectedProperty,
    filters,
    setSelectedProperty,
    setFilters,
    refreshProperties,
    updateProperty,
    deleteProperty,
    addProperty,
    getPropertyById,
    getPropertiesByStrategy,
    getPropertiesByDecision,
    searchProperties,
    // Favorites/Watchlist
    favoriteProperties,
    toggleFavorite,
    isFavorite,
  };

  return (
    <PropertyContext.Provider value={value}>
      {children}
    </PropertyContext.Provider>
  );
}

export function useProperties() {
  const context = useContext(PropertyContext);
  if (context === undefined) {
    throw new Error('useProperties must be used within a PropertyProvider');
  }
  return context;
}


[FILE_END: src\context\PropertyContext.tsx]
################################################################################
